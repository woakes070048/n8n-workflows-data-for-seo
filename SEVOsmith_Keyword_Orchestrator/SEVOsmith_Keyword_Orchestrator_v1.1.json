{
  "name": "SEVOsmith_Keyword_Orchestrator_v1.1",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.dataforseo.com/v3/dataforseo_labs/google/search_intent/live",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "=[\n  {\n    \"keywords\": [\n      \"{{ $('Set Input Data').item.json.keyword }}\"\n    ],\n    \"language_code\": \"{{ $('Set Input Data').item.json.language_code }}\"\n  }\n]",
        "options": {
          "redirect": {
            "redirect": {
              "followRedirects": false
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4416,
        1952
      ],
      "id": "1dfe8b2b-92e0-4782-af62-173975d6f66e",
      "name": "Search Intent",
      "credentials": {
        "httpBasicAuth": {
          "id": "ABmCxGcBagPhxsUA",
          "name": "DataforSEO"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.dataforseo.com/v3/dataforseo_labs/google/keyword_overview/live",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "=[\n  {\n    \"keywords\": [\n      \"{{ $('Set Input Data').item.json.keyword }}\"\n    ],\n    \"location_code\": {{ $('Set Input Data').item.json.country_code }},\n    \"language_code\": \"{{ $('Set Input Data').item.json.language_code }}\",\n    \"include_serp_info\": false,\n    \"include_clickstream_data\": false\n  }\n]",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4416,
        1648
      ],
      "id": "3b670493-4313-4eb0-afc7-57ea66816acc",
      "name": "Keyword Overview",
      "credentials": {
        "httpBasicAuth": {
          "id": "oquoOI3l93qFPfuK",
          "name": "Unnamed credential"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.dataforseo.com/v3/dataforseo_labs/google/keyword_ideas/live",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "=[\n  {\n    \"keywords\": [\n      \"{{ $('Set Input Data').item.json.keyword }}\"\n    ],\n    \"location_code\": {{ $('Set Input Data').item.json.country_code }},\n    \"language_code\": \"{{ $('Set Input Data').item.json.language_code }}\",\n    \"include_serp_info\": true,\n\t\"include_seed_keyword\": false,\n    \"limit\": {{ $('Set Input Data').item.json.limit }},\n\t\"ignore_synonyms\": true\n  }\n]",
        "options": {
          "redirect": {
            "redirect": {
              "followRedirects": false
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4416,
        1328
      ],
      "id": "017d4fca-08e7-4759-82e6-296ea06e8b11",
      "name": "Keyword Ideas",
      "credentials": {
        "httpBasicAuth": {
          "id": "oquoOI3l93qFPfuK",
          "name": "Unnamed credential"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.dataforseo.com/v3/serp/google/organic/live/advanced",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "=[\n  {\n    \"keyword\": \"{{ $('Set Input Data').item.json.keyword }}\",\n    \"location_code\": {{ $('Set Input Data').item.json.country_code }},\n    \"language_code\": \"{{ $('Set Input Data').item.json.language_code }}\",\n    \"depth\": 14,\n    \"group_organic_results\": true,\n    \"load_async_ai_overview\": false,\n    \"people_also_ask_click_depth\": 1\n  }\n]",
        "options": {
          "redirect": {
            "redirect": {
              "followRedirects": false
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4400,
        64
      ],
      "id": "54156125-f10a-446f-befa-8ba0ea88bc8f",
      "name": "SERP Google",
      "credentials": {
        "httpBasicAuth": {
          "id": "ABmCxGcBagPhxsUA",
          "name": "DataforSEO"
        }
      }
    },
    {
      "parameters": {
        "content": "## Related Keywords",
        "height": 272,
        "width": 704
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4352,
        912
      ],
      "id": "daed063b-cdef-425e-84b5-b18cc09d2a13",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "## Keyword Ideas",
        "height": 272,
        "width": 704,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4352,
        1232
      ],
      "id": "c1b5c3fa-e6bb-45c1-8c4b-b94e61722d7c",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "# AI Keyword Data â€“ Keyword Search Volume API\n\nThis API provides AI-based search volume data for specified keywords.  \nIt returns last monthâ€™s AI search volume and 12-month trends, calculated from questions in the \"People Also Ask\" SERP element.  \n\nðŸ‘‰ [Documentation](https://docs.dataforseo.com/v3/ai_optimization/ai_keyword_data/keywords_search_volume/live/?bash)\n",
        "height": 272,
        "width": 576,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5056,
        2208
      ],
      "id": "54ba9364-5c14-4612-82a5-1364d8eed83b",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.dataforseo.com/v3/ai_optimization/ai_keyword_data/keywords_search_volume/live",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "=[\n  {\n    \"language_code\": \"{{ $('Set Input Data').item.json.language_code }}\",\n    \"location_code\": {{ $('Set Input Data').item.json.country_code }},\n    \"keywords\": [\n      \"{{ $('Set Input Data').item.json.keyword }}\"\n    ]\n  }\n]\n",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4416,
        2304
      ],
      "id": "69225f2a-1489-49bc-abc4-53fbec059c24",
      "name": "AI Keyword Data",
      "credentials": {
        "httpBasicAuth": {
          "id": "ABmCxGcBagPhxsUA",
          "name": "DataforSEO"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.dataforseo.com/v3/serp/youtube/organic/live/advanced",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "=[\n  {\n    \"keyword\": \"{{ $('Set Input Data').item.json.keyword }}\",\n    \"location_code\": {{ $('Set Input Data').item.json.country_code }},\n    \"language_code\": \"{{ $('Set Input Data').item.json.language_code }}\",\n    \"device\": \"mobile\",\n    \"os\": \"android\",\n    \"block_depth\": 20\n  }\n]\n",
        "options": {
          "redirect": {
            "redirect": {
              "followRedirects": false
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4416,
        384
      ],
      "id": "5d695527-3bb8-447e-a806-00bc2afd8a51",
      "name": "SERP Youtube",
      "credentials": {
        "httpBasicAuth": {
          "id": "ABmCxGcBagPhxsUA",
          "name": "DataforSEO"
        }
      }
    },
    {
      "parameters": {
        "content": "## Keyword Overview",
        "height": 272,
        "width": 704,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4352,
        1552
      ],
      "id": "63055553-34c8-4aaf-898b-23284fa31630",
      "name": "Sticky Note12"
    },
    {
      "parameters": {
        "content": "## Search Intent",
        "height": 272,
        "width": 704,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4352,
        1872
      ],
      "id": "2966f257-1bc1-47b8-97d3-764a15be227e",
      "name": "Sticky Note13"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.dataforseo.com/v3/dataforseo_labs/google/related_keywords/live",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "=[\n  {\n    \"keyword\": \"{{ $('Set Input Data').item.json.keyword }}\",\n    \"location_code\": {{ $('Set Input Data').item.json.country_code }},\n    \"language_code\": \"{{ $('Set Input Data').item.json.language_code }}\",\n    \"depth\": 2,\n    \"include_seed_keyword\": false,\n    \"include_serp_info\": true,\n    \"ignore_synonyms\": true,\n    \"include_clickstream_data\": false,\n    \"replace_with_core_keyword\": true,\n    \"limit\": {{ $('Set Input Data').item.json.limit }}\n  }\n]",
        "options": {
          "redirect": {
            "redirect": {
              "followRedirects": false
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4416,
        1008
      ],
      "id": "999c64fc-1380-4d6e-a814-11716b0dad13",
      "name": "Related Keywords",
      "credentials": {
        "httpBasicAuth": {
          "id": "ABmCxGcBagPhxsUA",
          "name": "DataforSEO"
        }
      }
    },
    {
      "parameters": {
        "content": "# Google Organic Search API\n\nThis API lets you retrieve real-time Google search results with a wide range of parameters and custom settings.  \nThe response includes structured data for all available SERP features, along with a direct URL to the search results page.  \n\nðŸ‘‰ [Documentation](https://docs.dataforseo.com/v3/serp/overview/)\n",
        "height": 272,
        "width": 576,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5056,
        -16
      ],
      "id": "15c770ad-dd85-4a2b-ad56-965eea0c703f",
      "name": "Sticky Note17"
    },
    {
      "parameters": {
        "content": "# Google AI Mode API\n\nThis API provides AI-generated search result summaries and insights from Google.  \nIt returns detailed explanations, overviews, and related information based on search queries, with parameters to customize the AI overview.  \n\nðŸ‘‰ [Documentation](https://docs.dataforseo.com/v3/serp/google/ai_mode/overview/)\n",
        "height": 272,
        "width": 576,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5056,
        592
      ],
      "id": "99c1b90d-e143-455f-9172-5a6539e6acd4",
      "name": "Sticky Note18"
    },
    {
      "parameters": {
        "content": "# Related Keywords API\n\nThis API provides keywords from the \"searches related to\" element of Google SERP.  \nIt returns up to 4,680 related keywords with product categories, last monthâ€™s search volume, 12-month trends, CPC, competition, search intent, keyword difficulty, backlink data for top-10 pages, and clickstream insights.  \n\nðŸ‘‰ [Documentation](https://docs.dataforseo.com/v3/dataforseo_labs/google/related_keywords/live/)\n",
        "height": 272,
        "width": 560
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5056,
        912
      ],
      "id": "d5995526-fe15-45e7-9118-089b18baf939",
      "name": "Sticky Note20"
    },
    {
      "parameters": {
        "content": "# Google Keyword Ideas API\n\nThis API provides keyword ideas in the same category as specified seed keywords.  \nIt supports up to 200 seed keywords and returns search volume for the last month, 12-month trends, CPC, competition, search intent, keyword difficulty, backlink data for top-10 ranking pages, and clickstream insights.  \n\nðŸ‘‰ [Documentation](https://docs.dataforseo.com/v3/dataforseo_labs/google/keyword_ideas/live/)\n",
        "height": 272,
        "width": 576,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5056,
        1232
      ],
      "id": "f87e3859-547b-44e2-8947-aa5ef4e6e043",
      "name": "Sticky Note21"
    },
    {
      "parameters": {
        "content": "# Google Keyword Overview API\n\nThis API provides Google keyword data for specified keywords.  \nIt returns CPC, competition, search volume, search intent, monthly searches, SERP and backlink data, and clickstream insights.  \n\nðŸ‘‰ [Documentation](https://docs.dataforseo.com/v3/dataforseo_labs/google/keyword_overview/live/)\n",
        "height": 272,
        "width": 592,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5040,
        1552
      ],
      "id": "7f0b657a-ebfa-454a-88ae-e6e981b3593c",
      "name": "Sticky Note22"
    },
    {
      "parameters": {
        "content": "# Google Search Intent API\n\nThis API provides search intent for specified keywords.  \nIntents are categorized as navigational, informational, commercial, or transactional, and can be primary or secondary.  \n\nðŸ‘‰ [Documentation](https://docs.dataforseo.com/v3/dataforseo_labs/google/search_intent/live/)\n",
        "height": 272,
        "width": 592,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5040,
        1872
      ],
      "id": "91103742-f35e-426c-a873-59487434dac5",
      "name": "Sticky Note24"
    },
    {
      "parameters": {
        "content": "## AI Keyword Data",
        "height": 272,
        "width": 704,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4352,
        2208
      ],
      "id": "ca384d2e-b1fb-49ec-9b61-7bd5ddfaeb20",
      "name": "Sticky Note33"
    },
    {
      "parameters": {
        "content": "## SERP Youtube",
        "height": 272,
        "width": 704,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4352,
        288
      ],
      "id": "1abc46d6-cb92-451d-99c5-a4b99500e3b1",
      "name": "Sticky Note34"
    },
    {
      "parameters": {
        "content": "# YouTube Organic Search API\n\nThis API provides YouTube SERP data based on keyword, location, and language.  \nBy default, it returns a page of 20 content blocks (each with several video snippets).  \n\nðŸ‘‰ [Documentation](https://docs.dataforseo.com/v3/serp-youtube-organic-overview/)\n",
        "height": 272,
        "width": 576,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5056,
        288
      ],
      "id": "920e6df5-2e6c-49cd-9814-a1e324c008e8",
      "name": "Sticky Note35"
    },
    {
      "parameters": {
        "content": "## SERP Google",
        "height": 272,
        "width": 720,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4352,
        -16
      ],
      "id": "7a47d6b2-aaa8-4b21-bd6b-e73189fe5963",
      "name": "Sticky Note36"
    },
    {
      "parameters": {
        "content": "## AI Mode",
        "height": 272,
        "width": 704,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4352,
        592
      ],
      "id": "9c3145c0-b392-4e98-9d85-bd884cb593ed",
      "name": "Sticky Note37"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.dataforseo.com/v3/serp/google/ai_mode/live/advanced",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "=[\n  {\n    \"keyword\": \"{{ $('Set Input Data').item.json.keyword }}\",\n    \"location_code\": {{ $('Set Input Data').item.json.country_code }},\n    \"language_code\": \"{{ $('Set Input Data').item.json.language_code }}\",\n    \"device\": \"mobile\",\n    \"os\": \"android\"\n  }\n]",
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4416,
        688
      ],
      "id": "77f3722e-93dc-4f18-93ba-ac096a6da8eb",
      "name": "AI Mode",
      "credentials": {
        "httpBasicAuth": {
          "id": "ABmCxGcBagPhxsUA",
          "name": "DataforSEO"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "serp_google",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4928,
        48
      ],
      "id": "178a9599-51c1-4692-9499-99b019ca3120",
      "name": "serp_google"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "serp_youtube",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4896,
        368
      ],
      "id": "df392899-d97b-4f54-9003-750eb60e4c7f",
      "name": "serp_youtube"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "keyword_overview",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4896,
        1632
      ],
      "id": "eee4a610-16bd-4110-824f-eef5e9376adf",
      "name": "keyword_overview"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "keyword_ideas",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4896,
        1312
      ],
      "id": "0e2d80b4-0ab9-427a-8a6f-61e41d301334",
      "name": "keyword_ideas"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "related_keywords",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4896,
        992
      ],
      "id": "ca8fdad9-0174-4039-874b-0705153687f1",
      "name": "related_keywords"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "search_intent",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4912,
        1936
      ],
      "id": "d1553ba5-4d0d-4366-a266-d6737f6ba928",
      "name": "search_intent"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "ai_mode_data",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4896,
        672
      ],
      "id": "145b0066-7aae-4fc9-b803-666153bf38cb",
      "name": "ai_mode_data"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "ai_keyword_data",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4912,
        2288
      ],
      "id": "08f20d6e-78e7-46a1-9a3f-50829b9a09f3",
      "name": "ai_keyword_data"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.dataforseo.com/v3/content_generation/generate_sub_topics/live",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "=[{\n        \"topic\": \"{{ $('Set Input Data').item.json.keyword }}\"\n    }]",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4416,
        2656
      ],
      "id": "0ef54824-5efb-4332-aa92-0f0724666284",
      "name": "HTTP Subtopics",
      "credentials": {
        "httpBasicAuth": {
          "id": "ABmCxGcBagPhxsUA",
          "name": "DataforSEO"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "keyword_subtopics ",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4912,
        2640
      ],
      "id": "aebf9827-9c3a-4be2-9dbc-bafd58961259",
      "name": "keyword_subtopics"
    },
    {
      "parameters": {
        "numberInputs": 9
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        5760,
        80
      ],
      "id": "c9a61659-629a-4d82-a1a0-acaa22170d4c",
      "name": "Merge"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "raw_keyword_research_data",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        5936,
        192
      ],
      "id": "97cc5341-2059-4009-994d-6cf6daa757a6",
      "name": "raw_keyword_research_data"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function Node: SEVOsmith Data Normalizer & Compactor (v6.0)\n * ------------------------------------------------------------------------------------------\n * Copyright (c) 2025 Nextgrowth.AI | Author: The Minh Nguyen\n *\n * PURPOSE:\n * This script serves as the central data processing engine for the SEVOsmith Keyword Orchestrator.\n * It takes raw, aggregated API responses from various DataForSEO endpoints and transforms them\n * into a single, clean, structured, and enriched JSON object ready for storage, reporting,\n * and downstream consumption by LLMs or other services.\n *\n * --- INPUT SCHEMA ---\n * The script expects a single item with a `json` property containing:\n * {\n *   \"keyword\": \"primary seed keyword\", // (string) The main keyword for the research task.\n *   \"raw_keyword_research_data\": [ ... ], // (array) An array of raw response objects from DataForSEO.\n *   \"max_organic\": 20 // (number, optional) Cap for the number of organic SERP results to process.\n * }\n *\n * --- OUTPUT SCHEMA ---\n * The script adds the following key properties to the input item's `json` object:\n * - primary_keyword_record:  A detailed metrics object for the main seed keyword.\n * - keyword_records:         An array of detailed metrics objects for ALL discovered keywords.\n * - lightweight_ideas:       A simple array of supplementary keyword strings without metrics.\n * - serp_google_compact:     A distilled summary of Google SERP features (organic, PAA, etc.).\n * - serp_youtube_compact:    A distilled summary of top YouTube videos.\n * - ai_mode_data_compact:    A consolidated summary of Google's AI Overview/SGE data.\n * - competitor_urls:         A deduplicated list of competitor URLs from organic SERPs and AI sources.\n * - debug:                   A high-signal diagnostic object with counts, flags, and metadata.\n *\n * --- CORE FEATURES ---\n * - Data Unification: Merges keyword data from Keyword Overview, Keyword Ideas, and Related Keywords APIs.\n * - Metric Normalization: Creates a canonical `standard` object for each keyword, prioritizing the best\n *   available data for search volume, CPC, keyword difficulty, competition, and search trends.\n * - SERP Compaction: Intelligently parses complex SERP JSON to extract high-value elements like organic\n *   results, People Also Ask questions, and related searches into clean, usable arrays.\n * - AI Insights Consolidation: Aggregates AI Overviews from both the SERP and AI Mode APIs.\n * - Deterministic Ordering: Ensures keyword lists are stably ordered, with the primary keyword first.\n * - Robust Fallbacks: Gracefully handles missing data points and ensures a consistent output structure.\n */\n\n/* -------------------- Tunables -------------------- */\nlet MAX_ORGANIC  = Number.isFinite(Number(items[0]?.json?.max_organic))  ? Number(items[0].json.max_organic)  : 20;\n\n/* -------------------- Utilities -------------------- */\nconst norm = (s) => (s ?? '').toString().trim();\n\nfunction canonicalizeKeyword(k) {\n  return (k || \"\")\n    .toLowerCase()\n    .normalize(\"NFKD\")\n    .replace(/\\p{Sc}/gu, \"\")\n    .replace(/[\\u2000-\\u206F\\u2E00-\\u2E7F]/g, \" \")\n    .replace(/\\s*\\/\\s*/g, \" / \")\n    .replace(/[^\\p{L}\\p{N}]+/gu, \" \")\n    .replace(/\\s+/g, \" \")\n    .trim();\n}\nconst uniq = (arr) => Array.from(new Set((arr || []).filter(Boolean)));\n\nfunction cleanUrl(u){\n  try {\n    const url = new URL(u);\n    url.hash = '';\n    ['utm_source','utm_medium','utm_campaign','utm_term','utm_content','gclid','fbclid','mc_cid','mc_eid']\n      .forEach(p => url.searchParams.delete(p));\n    let path = url.pathname.replace(/\\/{2,}/g, '/');\n    if (path.length > 1 && path.endsWith('/')) path = path.slice(0, -1);\n    const qs = url.searchParams.toString();\n    return url.origin.toLowerCase() + path + (qs ? `?${qs}` : '');\n  } catch { return norm(u); }\n}\nfunction host(u){ try { return new URL(u).hostname.toLowerCase(); } catch { return \"\"; } }\n\nfunction walk(obj, fn) {\n  if (Array.isArray(obj)) { for (const v of obj) walk(v, fn); }\n  else if (obj && typeof obj === 'object') { fn(obj); for (const k of Object.keys(obj)) walk(obj[k], fn); }\n}\nfunction collectStringArrayDeep(obj, keys = ['sub_topics','subtopics','topics']) {\n  const out = [];\n  walk(obj, (node) => {\n    for (const key of keys) {\n      if (Array.isArray(node?.[key]) && node[key].every(x => typeof x === 'string')) {\n        out.push(...node[key]);\n      }\n    }\n  });\n  return out;\n}\n\n/* Date parsing â†’ UTC \"YYYY-MM-DD HH:mm:ss +00:00\" */\nfunction pad2(n){ return n < 10 ? '0'+n : ''+n; }\nfunction toUtcStamp(val){\n  if(!val && val!==0) return \"\";\n  let d=null;\n  if (typeof val === 'number') {\n    d = (val > 1e12) ? new Date(val) : new Date(val*1000);\n  } else {\n    const s = String(val).trim();\n    if (/^\\d{13}$/.test(s)) d = new Date(Number(s));\n    else if (/^\\d{10}$/.test(s)) d = new Date(Number(s)*1000);\n    else {\n      const parsed = Date.parse(s);\n      if (!Number.isNaN(parsed)) d = new Date(parsed);\n    }\n  }\n  if(!d || Number.isNaN(d.getTime())) {\n    return typeof val === 'string' ? val : \"\";\n  }\n  const Y = d.getUTCFullYear();\n  const M = pad2(d.getUTCMonth()+1);\n  const D = pad2(d.getUTCDate());\n  const h = pad2(d.getUTCHours());\n  const m = pad2(d.getUTCMinutes());\n  const s = pad2(d.getUTCSeconds());\n  return `${Y}-${M}-${D} ${h}:${m}:${s} +00:00`;\n}\n\n/* -------------------- DFS helpers -------------------- */\nfunction dfsResult(block){\n  if (!block) return null;\n  if (Array.isArray(block.tasks) && block.tasks[0]?.result?.[0]) return block.tasks[0].result[0];\n  if (Array.isArray(block.results) && block.results[0]) return block.results[0];\n  return null;\n}\nfunction dfsItems(block){\n  const res = dfsResult(block);\n  return res?.items || [];\n}\nfunction compactMonthly(months = [], field = 'search_volume'){\n  const list = Array.isArray(months) ? months.slice() : [];\n  list.sort((a,b)=> (b.year*12+b.month) - (a.year*12+a.month));\n  return list.slice(0,12).map(m => {\n    const d = new Date(m.year, m.month - 1, 1);\n    const lab = d.toLocaleString('en-US', { month: 'short', year: '2-digit' }).replace(',', '');\n    const [mmm, yy] = lab.split(' ');\n    return { month: `${mmm} '${yy}`, volume: Number(m[field] || 0) };\n  });\n}\nfunction yoyFromMonthly(compactArr){\n  if (!Array.isArray(compactArr) || compactArr.length < 12) return null;\n  const now = Number(compactArr[0]?.volume || 0);\n  const then= Number(compactArr[11]?.volume || 0);\n  if (!then) return null;\n  return Math.round(((now / then) - 1) * 100);\n}\nfunction seasonalityFromMonthly(compactArr){\n  if (!compactArr?.length) return \"\";\n}\nfunction mapCompLevel(v){\n  if (v == null) return \"\";\n  const s = String(v).toLowerCase();\n  if (s.includes('low')) return 'Low';\n  if (s.includes('med')) return 'Medium';\n  if (s.includes('high')) return 'High';\n  return \"\";\n}\nfunction compFromNumeric(n){\n  const x = Number(n);\n  if (!Number.isFinite(x)) return \"\";\n  if (x <= 0.33) return \"Low\";\n  if (x <= 0.66) return \"Medium\";\n  return \"High\";\n}\n\n/* -------------------- Builders -------------------- */\nfunction buildStandardMerged(parts){\n  const out = {\n    search_volume: 0,\n    cpc: 0,\n    keyword_difficulty: 0,\n    competition_level: \"\",\n    competition: 0,\n    monthly_searches: [],\n    last_12_months_trend: \"Unavailable (approx.)\",\n    seasonality_peak: \"\",\n    search_volume_trend: null,\n  };\n\n  function applyFrom(item){\n    if (!item) return;\n    const info = item.keyword_info || item.keyword_data?.keyword_info || {};\n    const props= item.keyword_properties || item.keyword_data?.keyword_properties || {};\n\n    if (!out.search_volume && info.search_volume != null) out.search_volume = Number(info.search_volume);\n    if (!out.cpc && info.cpc != null) out.cpc = Number(info.cpc);\n\n    if (!out.keyword_difficulty && (info.keyword_difficulty != null || props.keyword_difficulty != null)) {\n      out.keyword_difficulty = Number(info.keyword_difficulty ?? props.keyword_difficulty ?? 0);\n    }\n\n    if (!out.competition_level) {\n      const label  = mapCompLevel(info.competition_level);\n      const fromNum= compFromNumeric(info.competition);\n      out.competition_level = label || fromNum || out.competition_level;\n    }\n\n    if (!out.competition && Number.isFinite(Number(info.competition))) {\n      out.competition = Number(info.competition);\n    } else if (!out.competition && Number.isFinite(Number(props.competition))) {\n      out.competition = Number(props.competition);\n    }\n\n    if (!out.monthly_searches.length && Array.isArray(info.monthly_searches) && info.monthly_searches.length){\n      out.monthly_searches = compactMonthly(info.monthly_searches, 'search_volume');\n    }\n\n    if (!out.search_volume_trend && info.search_volume_trend && typeof info.search_volume_trend === 'object') {\n      out.search_volume_trend = {\n        monthly: Number(info.search_volume_trend.monthly ?? 0),\n        quarterly: Number(info.search_volume_trend.quarterly ?? 0),\n        yearly: Number(info.search_volume_trend.yearly ?? 0),\n      };\n    }\n  }\n  \n  applyFrom(parts.koItem);\n  applyFrom(parts.kiItem);\n  applyFrom(parts.rkItem);\n\n  if (out.monthly_searches.length) {\n    const yoy = yoyFromMonthly(out.monthly_searches);\n    out.last_12_months_trend =\n      (yoy == null) ? \"Unavailable (approx.)\"\n      : yoy > 5   ? `Growing Trend (+${yoy}% YoY)`\n      : yoy < -5  ? `Declining Trend (${yoy}% YoY)`\n      : `Stable Trend (${yoy}% YoY)`;\n    out.seasonality_peak = seasonalityFromMonthly(out.monthly_searches);\n  }\n  return out;\n}\n\nfunction buildAI(aiItem){\n  if (!aiItem) {\n    return { ai_search_volume: 0, monthly_searches: [], last_12_months_trend: \"Unavailable (approx.)\", seasonality_peak: \"\" };\n  }\n  const monthly = compactMonthly(aiItem.ai_monthly_searches, 'ai_search_volume');\n  const yoy = yoyFromMonthly(monthly);\n  const trend =\n    (yoy == null) ? \"Unavailable (approx.)\"\n    : yoy > 5     ? `Growing Trend (+${yoy}% YoY)`\n    : yoy < -5    ? `Declining Trend (${yoy}% YoY)`\n    : `Stable Trend (${yoy}% YoY)`;\n  return {\n    ai_search_volume: Number(aiItem.ai_search_volume ?? 0),\n    monthly_searches: monthly,\n    last_12_months_trend: trend,\n    seasonality_peak: \"\"\n  };\n}\n\nfunction intentMain(item){\n  const info = item?.search_intent_info || item?.keyword_data?.search_intent_info || {};\n  return info.main_intent ? String(info.main_intent) : \"\";\n}\n\n/* -------------------- Read & unify input blocks -------------------- */\nconst raw = items[0].json.raw_keyword_research_data;\nconst roots = Array.isArray(raw) ? raw : [raw];\n\nconst KO_ITEMS = [], KI_ITEMS = [], RK_ITEMS = [], RK_STRING_SIGNALS = [], AI_ITEMS = [];\nconst KO_ORDER = [], RK_ORDER = [], KI_ORDER = [], AI_ORDER = [];\n\nconst SG_ITEMS = [], SY_ITEMS = [], AMD_RESULTS = [];\nconst SUBTOPIC_STRINGS = [];\n\n// Helper to get any property whose trimmed name matches /^keyword[\\s_]*subtopics$/i\nfunction getSubtopicBlocks(obj){\n  const blocks = [];\n  if (!obj || typeof obj !== 'object') return blocks;\n  for (const k of Object.keys(obj)) {\n    const keyTrimLC = k.trim().toLowerCase();\n    if (/^keyword[\\s_]*subtopics$/.test(keyTrimLC)) {\n      const val = obj[k];\n      if (Array.isArray(val)) blocks.push(...val);\n      else if (val) blocks.push(val);\n    }\n  }\n  return blocks;\n}\n\nfor (const r of roots) {\n  // KO\n  if (Array.isArray(r?.keyword_overview)) {\n    for (const b of r.keyword_overview) {\n      const its = dfsItems(b);\n      if (its?.length) { KO_ITEMS.push(...its); its.forEach(x => { const k=canonicalizeKeyword(x.keyword); if (k) KO_ORDER.push(k); }); }\n    }\n  }\n  // KI\n  if (Array.isArray(r?.keyword_ideas)) {\n    for (const b of r.keyword_ideas) {\n      const its = dfsItems(b);\n      if (its?.length) { KI_ITEMS.push(...its); its.forEach(x => { const k=canonicalizeKeyword(x.keyword); if (k) KI_ORDER.push(k); }); }\n    }\n  }\n  // RK\n  if (Array.isArray(r?.related_keywords)) {\n    for (const b of r.related_keywords) {\n      const res = dfsResult(b);\n      if (res?.items?.length) {\n        for (const group of res.items) {\n          if (group?.keyword_data) {\n            RK_ITEMS.push(group.keyword_data);\n            const k = canonicalizeKeyword(group.keyword_data.keyword);\n            if (k) RK_ORDER.push(k);\n          }\n          if (Array.isArray(group?.related_keywords)) {\n            for (const rk of group.related_keywords) {\n              if (rk && typeof rk === 'object' && rk.keyword_data) {\n                RK_ITEMS.push(rk.keyword_data);\n                const k2 = canonicalizeKeyword(rk.keyword_data.keyword);\n                if (k2) RK_ORDER.push(k2);\n              } else if (typeof rk === 'string') {\n                RK_STRING_SIGNALS.push(rk);\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n  // AI volumes\n  if (Array.isArray(r?.ai_keyword_data)) {\n    for (const b of r.ai_keyword_data) {\n      const res = dfsResult(b);\n      if (Array.isArray(res?.items) && res.items.length) {\n        AI_ITEMS.push(...res.items);\n        res.items.forEach(x => { const k = canonicalizeKeyword(x.keyword); if (k) AI_ORDER.push(k); });\n      }\n    }\n  }\n  // SERP Google\n  if (Array.isArray(r?.serp_google)) {\n    for (const b of r.serp_google) {\n      const its = dfsItems(b);\n      if (its?.length) SG_ITEMS.push(...its);\n    }\n  }\n  // SERP YouTube\n  if (Array.isArray(r?.serp_youtube)) {\n    for (const b of r.serp_youtube) {\n      const its = dfsItems(b);\n      if (its?.length) SY_ITEMS.push(...its);\n    }\n  }\n  // AI mode data\n  if (Array.isArray(r?.ai_mode_data)) {\n    for (const b of r.ai_mode_data) {\n      const res = dfsResult(b);\n      if (res) AMD_RESULTS.push(res);\n    }\n  }\n  // keyword_subtopics â€” tolerant key; read result[].sub_topics and any nested string arrays\n  const subBlocks = getSubtopicBlocks(r);\n  for (const b of subBlocks) {\n    const res = dfsResult(b);\n    if (!res) continue;\n    if (Array.isArray(res?.sub_topics)) {\n      SUBTOPIC_STRINGS.push(...res.sub_topics.map(String));\n    }\n    const collected = collectStringArrayDeep(res, ['sub_topics','subtopics','topics']);\n    if (collected?.length) SUBTOPIC_STRINGS.push(...collected.map(String));\n    const fullResArr = (Array.isArray(b?.tasks?.[0]?.result) ? b.tasks[0].result : (Array.isArray(res) ? res : null));\n    if (Array.isArray(fullResArr)) {\n      for (const rr of fullResArr) {\n        if (Array.isArray(rr?.sub_topics)) SUBTOPIC_STRINGS.push(...rr.sub_topics.map(String));\n        const more = collectStringArrayDeep(rr, ['sub_topics','subtopics','topics']);\n        if (more?.length) SUBTOPIC_STRINGS.push(...more.map(String));\n      }\n    }\n  }\n}\n\n/* -------------------- Source maps -------------------- */\nconst mapKO=new Map(), mapKI=new Map(), mapRK=new Map(), mapAI=new Map();\nKO_ITEMS.forEach(it => { const k=canonicalizeKeyword(it.keyword); if (k) mapKO.set(k,it); });\nKI_ITEMS.forEach(it => { const k=canonicalizeKeyword(it.keyword); if (k && !mapKI.has(k)) mapKI.set(k,it); });\nRK_ITEMS.forEach(it => { const k=canonicalizeKeyword(it.keyword); if (k && !mapRK.has(k)) mapRK.set(k,it); });\nAI_ITEMS.forEach(it => { const k=canonicalizeKeyword(it.keyword); if (k && !mapAI.has(k)) mapAI.set(k,it); });\n\n/* -------------------- Primary keyword -------------------- */\nlet primaryKeyword = norm(items[0].json.keyword || items[0].json.primary_keyword || \"\");\nif (!primaryKeyword) {\n  primaryKeyword = norm(KO_ITEMS[0]?.keyword || KI_ITEMS[0]?.keyword || RK_ITEMS[0]?.keyword || AI_ITEMS[0]?.keyword || \"\");\n}\nif (!primaryKeyword) {\n    throw new Error(\"Could not determine primary keyword from input or any data source.\");\n}\nlet primaryKey = canonicalizeKeyword(primaryKeyword);\n\n\n/* -------------------- Build KeywordRecords -------------------- */\nfunction buildStandardRecordFromMaps(k){\n  const koItem = mapKO.get(k), kiItem = mapKI.get(k), rkItem = mapRK.get(k), aiItem = mapAI.get(k);\n  const display = norm(koItem?.keyword || kiItem?.keyword || rkItem?.keyword || aiItem?.keyword || k);\n  const standard = buildStandardMerged({ koItem, kiItem, rkItem });\n  const ai = buildAI(aiItem);\n  const main_intent = intentMain(koItem || kiItem || rkItem);\n  const provenance = [];\n  if (koItem) provenance.push(\"KO\");\n  if (rkItem) provenance.push(\"RK\");\n  if (kiItem) provenance.push(\"KI\");\n  if (aiItem) provenance.push(\"AI\");\n  return { keyword: display, keyword_canonical: k, standard, ai, main_intent, provenance };\n}\n\n/* Ordered canonicals: primary first, then KO â†’ RK â†’ KI â†’ AI (stable) */\nconst orderedCanonicals = [];\nconst seenCanon = new Set();\nfunction pushOrdered(list){\n  for (const k of list) {\n    if (!k) continue;\n    if (seenCanon.has(k)) continue;\n    if (k === primaryKey) continue;\n    seenCanon.add(k); orderedCanonicals.push(k);\n  }\n}\nif (primaryKey) { seenCanon.add(primaryKey); orderedCanonicals.unshift(primaryKey); }\npushOrdered(KO_ORDER); pushOrdered(RK_ORDER); pushOrdered(KI_ORDER); pushOrdered(AI_ORDER);\n\nlet keyword_records_raw = orderedCanonicals.map(buildStandardRecordFromMaps);\n\n/* Capture or fabricate primary */\nlet primary_keyword_record = keyword_records_raw.find(r => r.keyword_canonical === primaryKey) || null;\nif (!primary_keyword_record) {\n  primary_keyword_record = {\n    keyword: primaryKeyword,\n    keyword_canonical: primaryKey,\n    standard: buildStandardMerged({}), // Build an empty record\n    ai: buildAI(null),\n    main_intent: \"\",\n    provenance: [\"synthetic\"]\n  };\n  keyword_records_raw.unshift(primary_keyword_record);\n}\n\n\n/* Final keyword_records (strip ai) */\nfunction stripAi(record){ const { ai, ...rest } = record || {}; return rest; }\nconst keyword_records = keyword_records_raw.map(stripAi);\n\n/* -------------------- Relevance scoring -------------------- */\nfunction tokenize(s){ return canonicalizeKeyword(s).split(' ').filter(Boolean); }\nconst primaryTokens = tokenize(primaryKeyword);\nconst primarySet = new Set(primaryTokens);\nfunction overlapScore(candidate){\n  const toks = tokenize(candidate);\n  if (!toks.length || !primaryTokens.length) return 0;\n  let inter = 0; for (const t of toks) if (primarySet.has(t)) inter++;\n  const closeness = inter / primaryTokens.length;\n  const exactSub  = canonicalizeKeyword(candidate).includes(primaryKey) ? 0.2 : 0;\n  return closeness + exactSub;\n}\n\n/* -------------------- Lightweight ideas (RK strings without metrics) -------------------- */\nconst metricCanonicals = new Set(keyword_records.map(r => r.keyword_canonical));\nconst rkStringCanonAll = uniq(RK_STRING_SIGNALS.map(canonicalizeKeyword));\nconst rkStringFilteredCanon = rkStringCanonAll.filter(k => k && !metricCanonicals.has(k));\nconst relevance_ranked_lightweight_ideas_full = rkStringFilteredCanon\n  .map(k => {\n    const original = RK_STRING_SIGNALS.find(s => canonicalizeKeyword(s) === k) || k;\n    return { keyword: norm(original), relevance_score: overlapScore(original) };\n  })\n  .sort((a,b)=> b.relevance_score - a.relevance_score);\n\n/* -------------------- SERP: Google (compact + snapshot fields + de-noised groups) -------------------- */\nconst organicRows = [];\nconst paaQuestions = [];\nconst relatedOriginal = [];\nconst group_ai_overview = [];\nconst group_images = [];\nconst group_paa = [];\nconst group_perspectives = [];\nconst group_carousel = [];\nconst group_organic = [];\nconst group_related_all = [];\n\nfunction simplifyRefs(list){\n  const out = [];\n  for (const r of (list || [])) {\n    const u = cleanUrl(r?.url || r?.link || \"\");\n    out.push({ domain: r?.domain || host(u) || \"\", url: u, title: r?.title || \"\" });\n  }\n  // dedup by url\n  const seen = new Set(); const dedup = [];\n  for (const r of out) { const key = r.url || (r.domain + r.title); if (key && !seen.has(key)) { seen.add(key); dedup.push(r); } }\n  return dedup;\n}\nfunction collectLinkElements(node){\n  const links = [];\n  walk(node, n => {\n    if ((n?.type || \"\").toLowerCase() === 'link_element') {\n      const u = n.url || n.link || \"\";\n      links.push({ title: n.title || n.text || \"\", domain: host(u) || \"\", url: cleanUrl(u) });\n    }\n    if (n?.link_element && typeof n.link_element === 'object') {\n      const le = n.link_element;\n      const u = le.url || le.link || \"\";\n      links.push({ title: le.title || le.text || \"\", domain: host(u) || \"\", url: cleanUrl(u) });\n    }\n  });\n  const seen = new Set(); const out = [];\n  for (const l of links) {\n    const key = (l.url || \"\") + \"||\" + (l.title || \"\");\n    if (!seen.has(key) && (l.url || l.title)) { seen.add(key); out.push(l); }\n  }\n  return out;\n}\nfunction collectImagesElements(node){\n  const imgs = [];\n  walk(node, n => {\n    const t = (n?.type || \"\").toLowerCase();\n    if (t === 'images_element' || n?.images_element) {\n      const el = n?.images_element || n;\n      const u = el.url || el.image_url || el.link || \"\";\n      imgs.push({ alt: el.alt || el.title || \"\", url: cleanUrl(u) });\n    }\n  });\n  const seen = new Set(); const out = [];\n  for (const i of imgs) { if (!seen.has(i.url)) { seen.add(i.url); out.push(i); } }\n  return out;\n}\nfunction firstStringDeep(node, keys = ['markdown','text','answer','snippet','description']){\n  let found = \"\";\n  walk(node, n => {\n    if (found) return;\n    for (const k of keys) {\n      if (typeof n?.[k] === 'string' && n[k].trim()) { found = n[k].trim(); break; }\n    }\n  });\n  return found;\n}\n\nfor (const it of SG_ITEMS) {\n  const t = String(it.type || '').toLowerCase();\n\n  // --- Organic ---\n  if (t === 'organic') {\n    const title = it.title || \"\";\n    const snippet = it.description || it.snippet || \"\";\n    const url = cleanUrl(it.url || it.link || \"\");\n    if (url || title) {\n      organicRows.push({ title, snippet, url });\n      group_organic.push({ title, domain: host(url) || \"\", url, links: collectLinkElements(it) });\n    }\n  }\n\n  // --- People Also Ask ---\n  if (t === 'people_also_ask' && Array.isArray(it.items)) {\n    for (const q of it.items) {\n      const question = q.title || q.question || q.text || \"\";\n      if (!question) continue;\n\n      // Normalize expanded_element list\n      let expList = q.expanded_element;\n      if (expList && !Array.isArray(expList)) expList = [expList];\n      // pick the first with a description, else first available\n      let firstExp = Array.isArray(expList) && expList.length\n        ? (expList.find(e => (e && typeof e.description === 'string' && e.description.trim())) || expList[0])\n        : null;\n\n      const answer_snippet = norm(\n        (firstExp && firstExp.description) ||\n        firstStringDeep(firstExp) ||\n        \"\"\n      );\n\n      const ref = (firstExp && firstExp.url)\n        ? [{ domain: firstExp.domain || host(firstExp.url) || \"\", url: cleanUrl(firstExp.url), title: firstExp.title || \"\" }]\n        : [];\n\n      paaQuestions.push(question);\n      group_paa.push({ question, answer_snippet, references: ref });\n    }\n  }\n\n  // --- Related Searches (raw list for groups) ---\n  if (t === 'related_searches' && Array.isArray(it.items)) {\n    for (const rs of it.items) {\n      const val = typeof rs === 'string' ? rs : (rs.keyword || rs.query || rs.text || '');\n      if (val) { relatedOriginal.push(val); group_related_all.push(val); }\n    }\n  }\n\n  // --- Images ---\n  if (t === 'images') {\n    const imgs = collectImagesElements(it);\n    if (imgs.length) group_images.push(...imgs);\n  }\n\n  // --- Perspectives ---\n  if (t === 'perspectives' && Array.isArray(it.items)) {\n    for (const p of it.items) {\n      const el = p.perspectives_element || p;\n      const u = cleanUrl(el.url || el.link || \"\");\n      const title = el.title || el.text || \"\";\n      if (u || title) group_perspectives.push({ title, domain: host(u) || \"\", url: u });\n    }\n  }\n\n  // --- Carousel ---\n  if (t === 'carousel' && Array.isArray(it.items)) {\n    for (const c of it.items) {\n      const el = c.carousel_element || c;\n      if (el?.title) group_carousel.push({ title: el.title });\n    }\n  }\n\n  // --- Carousel (broadened support for *_carousel variants & nested elements) ---\n  if (t.includes('carousel')) {\n    const arr = Array.isArray(it.items) ? it.items\n             : Array.isArray(it.carousel_items) ? it.carousel_items\n             : Array.isArray(it.carousel) ? it.carousel\n             : [];\n\n    const seenKeys = new Set(group_carousel.map(c => (c.title || '') + '|' + (c.url || '')));\n\n    for (const c of arr) {\n      const el = c.carousel_element || c;\n      const title = el.title || el.name || el.text || \"\";\n      const url = cleanUrl(el.url || el.link || \"\");\n      const key = (title || '') + '|' + (url || '');\n      if (!title && !url) continue;\n      if (seenKeys.has(key)) continue;\n      group_carousel.push({ title, url, domain: host(url) || \"\" });\n      seenKeys.add(key);\n    }\n\n    // fallback: catch deeply nested single carousel_element objects\n    walk(it, n => {\n      if (n && n.carousel_element && typeof n.carousel_element === 'object') {\n        const el = n.carousel_element;\n        const title = el.title || el.name || el.text || \"\";\n        const url = cleanUrl(el.url || el.link || \"\");\n        const key = (title || '') + '|' + (url || '');\n        if (!title && !url) return;\n        if (seenKeys.has(key)) return;\n        group_carousel.push({ title, url, domain: host(url) || \"\" });\n        seenKeys.add(key);\n      }\n    });\n  }\n\n  // --- AI Overview (SERP) ---\n  if (t === 'ai_overview') {\n    const markdown = it.markdown || \"\";\n    // keep explicit references extraction for ai_overview blocks\n    const references = (function extractAiOverviewReferencesDeep(node){\n      const refs = [];\n      walk(node, n => {\n        if (Array.isArray(n?.references)) {\n          for (const r of n.references) {\n            const tt = (r?.type || \"\").toLowerCase();\n            if (tt === 'ai_overview_reference') refs.push(r);\n          }\n        }\n      });\n      return simplifyRefs(refs);\n    })(it);\n\n    const elements = [];\n    walk(it, (n) => {\n      if ((n?.type || \"\").toLowerCase() === 'ai_overview_element') {\n        elements.push({\n          text: n.text || \"\",\n          markdown: n.markdown || \"\",\n          references: (function(node){\n            const refs = [];\n            walk(node, nn => {\n              if (Array.isArray(nn?.references)) {\n                for (const rr of nn.references) {\n                  const tt = (rr?.type || \"\").toLowerCase();\n                  if (tt === 'ai_overview_reference') refs.push(rr);\n                }\n              }\n            });\n            return simplifyRefs(refs);\n          })(n)\n        });\n      }\n    });\n    group_ai_overview.push({ markdown, references, elements });\n  }\n}\n\n// organics: keep first MAX_ORGANIC, dedup ONLY by URL (allow same-title items)\nconst organicTop = [];\nconst seenUrls = new Set();\nfor (const o of organicRows) {\n  const u = (o.url || \"\").trim();\n  if (u) {\n    if (seenUrls.has(u)) continue;\n    seenUrls.add(u);\n  }\n  organicTop.push(o);\n  if (organicTop.length >= MAX_ORGANIC) break;\n}\n\n// PAA: dedup (no cap)\nconst paa_unique = uniq(paaQuestions);\n\n// related_searches: original relateds â†’ dedup â†’ filter by primary canonical substring â†’ append subtopics â†’ dedup\nlet related_filtered = uniq(relatedOriginal);\nif (primaryKey) {\n  related_filtered = related_filtered.filter(s => canonicalizeKeyword(s).includes(primaryKey));\n}\nconst SUBTOPICS_DEDUP = uniq(SUBTOPIC_STRINGS.map(s => norm(s)));\nconst related_searches = uniq([...related_filtered, ...SUBTOPICS_DEDUP]);\n\n/* ---- Inferred psychology (from PAA patterns only; no format buckets) ---- */\nconst paa_join_lc = paa_unique.map(s => s.toLowerCase());\nconst anyRisk   = paa_join_lc.some(q => /(is it ok|safe|normal|danger|risk|bad|should i|legal)/i.test(q));\nconst anyHowTo  = paa_join_lc.some(q => /\\bhow|when|what|can|why\\b/i.test(q));\nconst anyTiming = paa_join_lc.some(q => /\\bwhen|how often|how long|age|weeks?\\b/i.test(q));\nconst anyCompare= paa_join_lc.some(q => /\\bbest|vs\\.?|compare|top\\b/i.test(q));\nconst anyMedical= paa_join_lc.some(q => /\\bvaccine|parvo|worm|diarrhea|fever|vet\\b/i.test(q));\nlet psychParts = [];\nif (anyRisk)    psychParts.push(\"Users show risk sensitivity and seek reassurance.\");\nif (anyHowTo)   psychParts.push(\"They want step-by-step, actionable guidance.\");\nif (anyTiming)  psychParts.push(\"Timing and scheduling questions are prominent.\");\nif (anyCompare) psychParts.push(\"They compare options and seek 'best' choices.\");\nif (anyMedical) psychParts.push(\"Health/safety anxieties surface in medical queries.\");\nif (!psychParts.length && organicTop.length) {\n  psychParts.push(\"Users seek practical guidance and reputable sources.\");\n}\n\nconst serp_google_compact = {\n  organic_top20: organicTop,\n  paa_questions: uniq(paaQuestions),\n  related_searches,\n  inferred_user_psychology: psychParts.join(\" \"),\n  groups: {\n    ai_overview: group_ai_overview,\n    images: group_images,\n    people_also_ask: group_paa,\n    organic: group_organic,\n    perspectives: group_perspectives,\n    carousel: group_carousel,\n    related_searches_all: uniq(group_related_all)\n  }\n};\n\n/* -------------------- SERP: YouTube (with normalized publication_date) -------------------- */\nfunction pickPublished(it){\n  return it.timestamp || it.published_time || it.published_time_utc || it.published_at || it.published_date || it.upload_date || it.date || it.published || \"\";\n}\nconst ytRows = SY_ITEMS.map(it => ({\n  title: it.title || \"\",\n  channel: it.channel_name || it.channel || it.author || \"\",\n  views: Number(it.views_count || it.view_count || it.views || 0),\n  is_shorts: Boolean(it.is_shorts),\n  url: cleanUrl(it.url || it.link || \"\"),\n  publication_date: toUtcStamp(pickPublished(it))\n}));\nconst serp_youtube_compact = {\n  videos_top20: ytRows.slice().sort((a,b)=>(b.views||0)-(a.views||0)).slice(0, 20).filter(v => v.url || v.title || v.channel)\n};\n\n/* -------------------- AI mode data (full concat + elements + authoritative refs + SERP AI overview) -------------------- */\nlet overviewMarkdowns = [];\nlet elements = [];\nlet refUrls = [];\nfor (const res of AMD_RESULTS) {\n  walk(res, (node) => {\n    const t = (node?.type || \"\").toLowerCase();\n    if (t === 'ai_overview') {\n      if (node.markdown) overviewMarkdowns.push(String(node.markdown));\n      if (Array.isArray(node.references)) {\n        for (const r of node.references) {\n          const rtype = (r?.type || \"\").toLowerCase();\n          if (rtype === 'ai_overview_reference') {\n            const u = r.url || r.link; if (u) refUrls.push(cleanUrl(u));\n          }\n        }\n      }\n    }\n    if (t === 'ai_overview_element') {\n      const el = {\n        title: node.title || \"\",\n        text: node.text || \"\",\n        markdown: node.markdown || \"\",\n        references: Array.isArray(node.references) ? node.references.map(r => ({...r})) : []\n      };\n      if (el.title || el.text || el.markdown || (el.references && el.references.length)) {\n        elements.push(el);\n        if (Array.isArray(el.references)) {\n          for (const r of el.references) {\n            const rtype = (r?.type || \"\").toLowerCase();\n            if (rtype === 'ai_overview_reference') {\n              const u = r.url || r.link; if (u) refUrls.push(cleanUrl(u));\n            }\n          }\n        }\n      }\n    }\n  });\n}\n\n// Also ingest SERP Google ai_overview blocks into ai_mode_data_compact\nconst serp_ai_overview = serp_google_compact.groups.ai_overview.map(x => ({\n  markdown: x.markdown || \"\",\n  elements: (x.elements || []).map(e => ({\n    text: e.text || \"\",\n    markdown: e.markdown || \"\",\n    references: (e.references || []).map(r => ({ domain: r.domain || host(r.url) || \"\", url: r.url || \"\", title: r.title || \"\" }))\n  })),\n  references: (x.references || []).map(r => ({ domain: r.domain || host(r.url) || \"\", url: r.url || \"\", title: r.title || \"\" }))\n}));\n\n// Merge SERP AI overview references into authoritative sources\nfor (const block of serp_ai_overview) {\n  for (const r of (block.references || [])) {\n    if (r.url) refUrls.push(cleanUrl(r.url));\n  }\n}\n\nconst ai_mode_data_compact = {\n  key_takeaway: overviewMarkdowns.join(\"\\n\\n\").trim(),\n  authoritative_sources: uniq(refUrls).slice(0, 200),\n  elements,\n  serp_ai_overview\n};\n\n/* -------------------- competitor_urls (organic URLs âˆª authoritative_sources) -------------------- */\nconst competitor_urls = uniq([\n  ...serp_google_compact.organic_top20.map(o => o.url).filter(Boolean),\n  ...ai_mode_data_compact.authoritative_sources\n]).map(cleanUrl);\n\n/* -------------------- Final outputs -------------------- */\nconst final_output = items[0];\n\nfinal_output.json.primary_keyword_record = primary_keyword_record;\nfinal_output.json.keyword_records = keyword_records;\nfinal_output.json.lightweight_ideas = relevance_ranked_lightweight_ideas_full.map(idea => idea.keyword);\nfinal_output.json.serp_google_compact    = serp_google_compact;\nfinal_output.json.serp_youtube_compact   = serp_youtube_compact;\nfinal_output.json.ai_mode_data_compact   = ai_mode_data_compact;\nfinal_output.json.competitor_urls        = competitor_urls;\n\ndelete final_output.json.raw_keyword_research_data;\n\n/* -------------------- Debug (compact, high-signal) -------------------- */\nconst raw_total_rows =\n  KO_ITEMS.length + KI_ITEMS.length + RK_ITEMS.length + AI_ITEMS.length;\nconst unique_metric_bearing = new Set([...new Set([...KO_ORDER, ...RK_ORDER, ...KI_ORDER, ...AI_ORDER])]).size;\nconst duplicates_removed = Math.max(0, raw_total_rows - unique_metric_bearing);\nconst dup_ratio = raw_total_rows ? Number((duplicates_removed / raw_total_rows).toFixed(3)) : 0;\n\nconst primary_presence = {\n  in_KO: mapKO.has(primaryKey),\n  in_KI: mapKI.has(primaryKey),\n  in_RK: mapRK.has(primaryKey),\n  in_AI: mapAI.has(primaryKey)\n};\n\nconst flags = [];\nif (!ai_mode_data_compact.elements.length && !ai_mode_data_compact.serp_ai_overview.length) flags.push(\"no_ai_elements\");\nif (!serp_youtube_compact.videos_top20?.length) flags.push(\"no_youtube\");\nif (!serp_google_compact.paa_questions?.length) flags.push(\"thin_paa_coverage\");\nif (!serp_google_compact.related_searches?.length) flags.push(\"low_related_terms\");\nif (!primary_keyword_record?.keyword) flags.push(\"primary_missing_in_sources\");\n\nfinal_output.json.debug = {\n  counts_by_source: { KO: KO_ITEMS.length, RK: RK_ITEMS.length, KI: KI_ITEMS.length, AI: AI_ITEMS.length },\n  unique_keywords_metric_bearing: unique_metric_bearing,\n  unique_rk_string_signals: rkStringFilteredCanon.length,\n  duplicates_removed,\n  dup_ratio,\n  primary_keyword: primaryKeyword || \"\",\n  primary_presence,\n  selection_summary: {\n    total_metric_keywords_output: keyword_records.length,\n    total_lightweight_ideas_output: relevance_ranked_lightweight_ideas_full.length,\n  },\n  serp_sizes: {\n    organic_top: serp_google_compact.organic_top20.length,\n    paa_unique: serp_google_compact.paa_questions.length,\n    related_unique: serp_google_compact.related_searches.length,\n    subtopics_appended: SUBTOPICS_DEDUP.length,\n    yt_top: serp_youtube_compact.videos_top20.length\n  },\n  limits: { MAX_ORGANIC },\n  flags\n};\n\n// Add types_seen to help verify incoming SERP block types\nfinal_output.json.debug.types_seen = Array.from(\n  new Set(SG_ITEMS.map(it => String(it.type || '').toLowerCase()))\n).sort();\n\n// Optional micro-summaries (uncomment if you want quick counts in output):\nfinal_output.json.serp_google_compact.group_counts = {\n  ai_overview: serp_google_compact.groups.ai_overview.length,\n  people_also_ask: serp_google_compact.groups.people_also_ask.length,\n  images: serp_google_compact.groups.images.length,\n  organic: serp_google_compact.groups.organic.length,\n  perspectives: serp_google_compact.groups.perspectives.length,\n  carousel: serp_google_compact.groups.carousel.length\n};\n\nreturn [final_output];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6320,
        192
      ],
      "id": "211fb8cc-265b-41ff-b208-de9e348c3f94",
      "name": "Normalize_and_Compact"
    },
    {
      "parameters": {
        "content": "# Generate Subtopics API\n\nHttp request made to DataForSEO to get subtopics based on the main keyword. \n\nðŸ‘‰ [Documentation](https://docs.dataforseo.com/v3/content_generation/generate_sub_topics/live/?bash)\n",
        "height": 272,
        "width": 576
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5056,
        2544
      ],
      "id": "a575bc2a-4e79-4c65-8487-e8e28a8f6af5",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "content": "## Get Subtopics",
        "height": 272,
        "width": 704
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4352,
        2544
      ],
      "id": "e90c1272-5620-48c9-a783-b000c2e84975",
      "name": "Sticky Note38"
    },
    {
      "parameters": {
        "content": "# 1. Initiation & Configuration\n\n**Objective:** Find and configure the next keyword research job.\n\n*   **Trigger/Filter:** Activates when a new row in 'Campaign Start' is marked `Submit` and `Not_Started`.\n*   **Get Main Keyword:** Fetches the *single oldest* job to process.\n*   **Get KW Research Setting:** Loads global settings (API keys, limits, output paths) for the run.",
        "height": 656,
        "width": 928,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1040,
        848
      ],
      "id": "21248579-9165-4959-809a-1173988b9038",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "![n8n Creator Profile](https://app.dataforseo.com/assets/images/ukr-logo-border-706-104.png)",
        "width": 768,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1040,
        672
      ],
      "id": "dadf340d-366c-46a1-8a2f-9ba72365c84a",
      "name": "Sticky Note30"
    },
    {
      "parameters": {
        "content": "![nextgrowth.ai](https://nextgrowth.ai/wp-content/uploads/2025/08/cropped-logo.png)",
        "width": 400,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1808,
        672
      ],
      "id": "5c0559b0-c641-4f0f-aa04-842f4b316471",
      "name": "Sticky Note31"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6be27e54-0d3a-441f-96da-47a001e56028",
              "leftValue": "={{ $json.hasOwnProperty('cache_content') }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2768,
        1328
      ],
      "id": "63343419-c8e4-46c4-8b0e-b1cb6fafdb1b",
      "name": "Cache Hit?"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8",
          "mode": "list",
          "cachedResultName": "SEVOsmith_Manager_Sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2121947407,
          "mode": "list",
          "cachedResultName": "KW_Reseach_Setting",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit#gid=2121947407"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1744,
        1104
      ],
      "id": "87931db6-50a7-47a3-86c3-b8a7ffaa9ced",
      "name": "Get KW Research Setting",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "auYpM9otybGTlYsx",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8",
          "mode": "list",
          "cachedResultName": "SEVOsmith_Manager_Sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 484582664,
          "mode": "list",
          "cachedResultName": "Campaign Start",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit#gid=484582664"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Action",
              "lookupValue": "Submit"
            },
            {
              "lookupColumn": "Status",
              "lookupValue": "To_Do"
            }
          ]
        },
        "options": {
          "returnFirstMatch": true
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1488,
        1104
      ],
      "id": "8218cfb6-d9d2-4cd2-8728-b9db2d1f5e44",
      "name": "Get Main Keyword",
      "executeOnce": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "auYpM9otybGTlYsx",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "94c47426-abdb-40ce-a0ab-5bdb70b95480",
              "name": "project",
              "value": "={{ $('Get Main Keyword').item.json.Project }}",
              "type": "string"
            },
            {
              "id": "50af0977-2011-49c8-adaf-2fd3f10b56bf",
              "name": "session_id",
              "value": "={{ $json.session_id }}",
              "type": "string"
            },
            {
              "id": "16f336f7-0d11-413c-bb50-4b1769d4331d",
              "name": "workflow_execution_id",
              "value": "={{ $execution.id }}",
              "type": "string"
            },
            {
              "id": "5f4b8576-0afa-439b-9ae1-9c38822fed3b",
              "name": "keyword",
              "value": "={{ $('Get Main Keyword').item.json.Keyword }}",
              "type": "string"
            },
            {
              "id": "b887d01b-9ebb-4165-8549-f3b859270991",
              "name": "country_code",
              "value": "={{ $('Get KW Research Setting').item.json[\"Location Code\"] }}",
              "type": "string"
            },
            {
              "id": "d264138d-2a20-4545-9dba-d76b3397e40b",
              "name": "language_code",
              "value": "={{ $('Get KW Research Setting').item.json[\"Language Code\"] }}",
              "type": "string"
            },
            {
              "id": "3d7c4895-67a2-42a9-8393-0cc2ff1a2de3",
              "name": "limit",
              "value": "={{ $('Get KW Research Setting').item.json.Litmit }}",
              "type": "string"
            },
            {
              "id": "0f8e49cc-c6cb-4ea8-9b6a-a99999424186",
              "name": "cache_key",
              "value": "={{ $json.normalize_kw }}__{{ $('Get Main Keyword').item.json.Project }}__{{ $('Get KW Research Setting').item.json[\"Location Code\"] }}__{{ $('Get KW Research Setting').item.json[\"Language Code\"] }}",
              "type": "string"
            },
            {
              "id": "2c35f255-8d7a-4d62-9e65-e8d0a1271ce7",
              "name": "upload_drive",
              "value": "={{ $('Get KW Research Setting').item.json[\"Upload to G-drive\"] }}",
              "type": "string"
            },
            {
              "id": "eeacf545-1a66-4b90-b64d-683c8678c612",
              "name": "upload_s3",
              "value": "={{ $('Get KW Research Setting').item.json[\"Upload to Cloudflade R2\"] }}",
              "type": "string"
            },
            {
              "id": "5a39c06c-4732-4acd-9954-3223ec6056f5",
              "name": "save_raw_data",
              "value": "={{ $('Get KW Research Setting').item.json[\"Save Raw Data\"] }}",
              "type": "string"
            },
            {
              "id": "a761a9d9-c61c-473d-ba86-1bc675bab01f",
              "name": "email_notify",
              "value": "={{ $('Get KW Research Setting').item.json[\"Email Notify\"] }}",
              "type": "string"
            },
            {
              "id": "60c02dce-1283-44c6-8128-c1ec971ef084",
              "name": "send_to_email",
              "value": "={{ $('Get KW Research Setting').item.json[\"Email to receive report\"] }}",
              "type": "string"
            },
            {
              "id": "82ce07d2-355a-48ff-be55-ae882f315d02",
              "name": "google_drive_folder",
              "value": "={{ $('Get KW Research Setting').item.json[\"Google Drive Folder  id\"] }}",
              "type": "string"
            },
            {
              "id": "63e3d0c1-df4b-44c5-b0d2-dc152c3c4fca",
              "name": "s3_link_pub",
              "value": "={{ $('Get KW Research Setting').item.json[\"Cloudflade R2 link\"] }}",
              "type": "string"
            },
            {
              "id": "6c4bc496-6cb9-4461-970d-58088abe391d",
              "name": "normalize_kw",
              "value": "={{ $json.normalize_kw }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2752,
        1104
      ],
      "id": "cc1b39dc-1a8c-48e2-8bed-e9527012e06a",
      "name": "Set Input Data"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyX",
              "unit": "minutes"
            }
          ]
        },
        "documentId": {
          "__rl": true,
          "value": "1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8",
          "mode": "list",
          "cachedResultName": "SEVOsmith_Manager_Sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 484582664,
          "mode": "list",
          "cachedResultName": "Campaign Start",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit#gid=484582664"
        },
        "options": {
          "columnsToWatch": [
            "Action",
            "Status"
          ]
        }
      },
      "type": "n8n-nodes-base.googleSheetsTrigger",
      "typeVersion": 1,
      "position": [
        1088,
        1104
      ],
      "id": "e31919bb-9530-42ee-94bf-0ece5fe1e3ee",
      "name": "SEVOsmith_Trigger",
      "credentials": {
        "googleSheetsTriggerOAuth2Api": {
          "id": "DUj9LNRfjPyDpEJB",
          "name": "Google Sheets Trigger account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// n8n Code Node: Generate Session ID & Normalize Keyword\n// ------------------------------------------------------------------------------------------\n// PURPOSE:\n// 1. Generates a unique, time-sortable session ID.\n// 2. Normalizes an input keyword string into a \"slug\" format (e.g., \"my keyword\" -> \"my-keyword\").\n//\n// INPUT (from previous node):\n// - A JSON object with a 'keyword' property. Example: { \"keyword\": \"n8n keyword abc\" }\n//\n// OUTPUT:\n// - A single JSON object containing both the new session_id and the normalized keyword.\n\nconst rawKeyword = $('Get Main Keyword').first().json.Keyword;\n\n// --- 1. Session ID Generation (logic retained from original script) ---\nconst d = new Date();\nconst pad2 = (n) => String(n).padStart(2, '0');\n\nconst year = d.getUTCFullYear().toString().slice(-2);\nconst month = pad2(d.getUTCMonth() + 1);\nconst day = pad2(d.getUTCDate());\nconst hours = pad2(d.getUTCHours());\nconst minutes = pad2(d.getUTCMinutes());\nconst timestamp = `${year}${month}${day}${hours}${minutes}`;\n\n// 4-digit hex for 65k combinations/minute to prevent collisions\nconst randomSuffix = Math.floor(Math.random() * 0x10000).toString(16).padStart(4, '0');\nconst sessionId = `${timestamp}${randomSuffix}`;\n\n// --- 2. Keyword Normalization (new logic) ---\n// This regex replaces one or more whitespace characters (\\\\s+) globally (g) with a single hyphen.\n// It's more robust than just replacing single spaces.\nconst normalizedKeyword = rawKeyword.toLowerCase().replace(/\\s+/g, '-');\n\n// --- 3. Return Combined Output ---\nreturn [{\n  json: {\n    session_id: sessionId,\n    normalize_kw: normalizedKeyword\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2304,
        1104
      ],
      "id": "6b5cb8b9-cd20-420f-a067-16bc0b7b2ada",
      "name": "Generate_Session_ID"
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "smda3oGWtU6DGepT",
          "mode": "list",
          "cachedResultName": "SEVOsmith_KW_Cache",
          "cachedResultUrl": "/projects/NDZtAl2Y5mdJzN72/datatables/smda3oGWtU6DGepT"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "session_id": "={{ $('Generate_Session_ID').item.json.session_id }}",
            "cache_id": "={{ $('Set Input Data').item.json.cache_key }}",
            "cache_content": "={{ $json.serialized_research_data }}",
            "Project": "={{ $('Set Input Data').item.json.project }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Project",
              "displayName": "Project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "session_id",
              "displayName": "session_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "cache_id",
              "displayName": "cache_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "cache_content",
              "displayName": "cache_content",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "optimizeBulk": false
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        7552,
        192
      ],
      "id": "e56be28b-b37a-4ca7-9237-c7441ac9fb47",
      "name": "Create Cache"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "normalize_keyword_research_data",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        6752,
        192
      ],
      "id": "3b804905-c104-4e1c-9e26-968a64776bf2",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c713f1fc-c731-4ae7-ad34-2cbb3b00b876",
              "name": "session_id",
              "value": "={{ $('Generate_Session_ID').item.json.session_id }}",
              "type": "string"
            },
            {
              "id": "a13c9cb1-5337-4325-bab5-e43bb9a116b0",
              "name": "primary_keyword",
              "value": "={{ $('Set Input Data').item.json.keyword }}",
              "type": "string"
            },
            {
              "id": "157fd666-0abb-4bd9-8bc6-b92ed797d7ed",
              "name": "keyword",
              "value": "={{ $json.keyword }}",
              "type": "string"
            },
            {
              "id": "33d0209e-14c5-4909-9f8a-d020626b09a9",
              "name": "search_volume",
              "value": "={{ $json.standard.search_volume }}",
              "type": "number"
            },
            {
              "id": "86cf7aeb-4eb2-4b67-9d4b-968e995aa280",
              "name": "cpc",
              "value": "={{ $json.standard.cpc }}",
              "type": "number"
            },
            {
              "id": "93d3f4b9-4678-4315-9c93-848ae961534d",
              "name": "keyword_difficulty",
              "value": "={{ $json.standard.keyword_difficulty }}",
              "type": "number"
            },
            {
              "id": "690dfafc-d329-4f29-9ffb-15fcda2a14b9",
              "name": "competition_level",
              "value": "={{ $json.standard.competition_level }}",
              "type": "string"
            },
            {
              "id": "73259597-5d97-4df0-9c65-29d6d8bdc051",
              "name": "main_intent",
              "value": "={{ $json.main_intent }}",
              "type": "string"
            },
            {
              "id": "526204de-1f58-45e4-9b1c-ffb43c44bce8",
              "name": "yoy_trend",
              "value": "={{ $json.standard.last_12_months_trend }}",
              "type": "string"
            },
            {
              "id": "fe82b8f0-c152-4670-81cb-d618d4d0f516",
              "name": "monthly_searches_json",
              "value": "={{ JSON.stringify($json.standard.monthly_searches) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        7152,
        688
      ],
      "id": "a955b234-6986-44a4-a298-58e9e2dd480d",
      "name": "Prepare Sheet Row"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "={{ $('Google Drive Copy KW Template').item.json.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 2108933567,
          "mode": "list",
          "cachedResultName": "Keyword Records",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ejfJSFkj3scHDskcv9S3Zd-yGYzekrNgLU51op3q2wo/edit#gid=2108933567"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Main Keyword": "={{ $json.primary_keyword }}",
            "Session ID": "={{ $json.session_id }}",
            "Keyword": "={{ $json.keyword }}",
            "Monthly Search Volume": "={{ $json.search_volume }}",
            "CPC": "={{ $json.cpc }}",
            "KW Difficulty": "={{ $json.keyword_difficulty }}",
            "Competition": "={{ $json.competition_level }}",
            "Intent": "={{ $json.main_intent }}",
            "\nYoY Trend": "={{ $json.yoy_trend }}",
            "Monthly Searches JSON": "={{ $json.monthly_searches_json }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Session ID",
              "displayName": "Session ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Main Keyword",
              "displayName": "Main Keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Keyword",
              "displayName": "Keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Monthly Search Volume",
              "displayName": "Monthly Search Volume",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CPC",
              "displayName": "CPC",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "KW Difficulty",
              "displayName": "KW Difficulty",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Competition",
              "displayName": "Competition",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Intent",
              "displayName": "Intent",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "\nYoY Trend",
              "displayName": "\nYoY Trend",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Monthly Searches JSON",
              "displayName": "Monthly Searches JSON",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Notes",
              "displayName": "Notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        7360,
        688
      ],
      "id": "255dfae2-6be3-4917-90cc-419b0bf14edb",
      "name": "Add Keyword Metrics to Google Sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "auYpM9otybGTlYsx",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Function Node: SEVOsmith Keyword Research Report Synthesizer (v7.2)\n * ------------------------------------------------------------------------------------------\n * Copyright (c) 2025 Nextgrowth.AI | Author: The Minh Nguyen\n *\n * PURPOSE:\n * Synthesizes a structured JSON object from the 'SEVOsmith Data Normalizer' into a single,\n * self-contained, interactive HTML report for comprehensive keyword analysis.\n *\n * --- INPUT SCHEMA ---\n * The script expects a single item with a `json` property containing the full, normalized\n * data structure, including:\n * {\n *   \"primary_keyword_record\": { ... },\n *   \"keyword_records\": [\n *     {\n *       \"keyword\": \"example keyword\",\n *       \"standard\": {\n *         \"search_volume\": 1000,\n *         \"keyword_difficulty\": 25,\n *         \"cpc\": 1.5,\n *         \"last_12_months_trend\": \"Growing Trend (+22% YoY)\"\n *       },\n *       \"main_intent\": \"informational\"\n *     },\n *     ...\n *   ],\n *   \"lightweight_ideas\": [ ... ],\n *   \"serp_google_compact\": { ... },\n *   ...and other normalized data blocks.\n * }\n *\n * --- OUTPUT SCHEMA ---\n * The script returns two items:\n * 1. A JSON object containing the complete, self-contained HTML report:\n *    { \"json\": { \"html_report\": \"<!DOCTYPE html>...\" } }\n * 2. The original input data, passed through for subsequent workflow steps.\n *\n * --- CORE FEATURES ---\n * - Self-Contained & Interactive: Generates a single HTML file with embedded CSS and JS,\n *   requiring no external dependencies beyond CDN-hosted Chart.js and Marked.js.\n * - Advanced Keyword Table:\n *   - Sortable columns for all key metrics, including Volume, KD, CPC, and a 12-Month Trend summary.\n *   - Multi-parameter filtering (text search, volume range, KD max, intent).\n *   - Table pagination and row-count selection.\n *   - CSV export of the currently filtered and sorted data.\n * - Strategic Data Visualization:\n *   - Automated topic clustering with interactive filtering.\n *   - Charts for Intent and Keyword Difficulty distribution.\n *   - Primary keyword trendline analysis (Standard vs. AI volume) with linear regression.\n * - Rich Content Display: Renders AI Overviews from Markdown and provides an interactive\n *   JSON tree viewer for inspecting the raw input data.\n */\n\nconst data = items[0].json;\n\n// --- UTILITY FUNCTIONS ---\n\nfunction escapeHtml(text) {\n    if (text === null || typeof text === 'undefined') return '';\n    const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', \"'\": '&#039;' };\n    return String(text).replace(/[&<>\"']/g, m => map[m]);\n}\n\nfunction formatListToHtml(items, className = '') {\n    if (!items || items.length === 0) return `<ul class=\"empty-list\"><li class=\"${className}\">N/A</li></ul>`;\n    return `<ul>${items.map(item => `<li class=\"${className}\">${escapeHtml(item)}</li>`).join('')}</ul>`;\n}\n\nfunction formatListWithLinks(items, className = '') {\n    if (!items || items.length === 0) return `<ul class=\"empty-list\"><li class=\"${className}\">N/A</li></ul>`;\n    return `<ul>${items.map(item => `<li class=\"${className}\"><a href=\"${escapeHtml(item)}\" target=\"_blank\" rel=\"noopener noreferrer\">${escapeHtml(item)}</a></li>`).join('')}</ul>`;\n}\n\nfunction buildJsonTreeHtml(obj, isRoot = true) {\n    if (obj === null || typeof obj !== 'object') return `<ul class=\"json-tree\"><li>${renderJsonValue(obj)}</li></ul>`;\n    let html = isRoot ? '<ul class=\"json-tree\">' : '<ul class=\"json-tree-nested\">';\n    const keys = Object.keys(obj);\n    keys.forEach((key, index) => {\n        const value = obj[key];\n        const isObject = value !== null && typeof value === 'object';\n        const comma = index < keys.length - 1 ? ',' : '';\n        const keyHtml = Array.isArray(obj) ? '' : `<span class=\"json-key\">\"${escapeHtml(key)}\"</span>: `;\n        if (isObject) {\n            html += `<li><span class=\"json-toggle\">+</span>${keyHtml}${Array.isArray(value) ? '[' : '{'}`;\n            html += buildJsonTreeHtml(value, false);\n            html += `${Array.isArray(value) ? ']' : '}'}${comma}</li>`;\n        } else {\n            html += `<li>${keyHtml}${renderJsonValue(value)}${comma}</li>`;\n        }\n    });\n    return html + '</ul>';\n}\n\nfunction renderJsonValue(value) {\n    if (value === null) return `<span class=\"json-null\">null</span>`;\n    const type = typeof value;\n    if (type === 'string') return `<span class=\"json-string\">\"${escapeHtml(value)}\"</span>`;\n    if (type === 'number') return `<span class=\"json-number\">${value}</span>`;\n    if (type === 'boolean') return `<span class=\"json-boolean\">${value}</span>`;\n    return escapeHtml(String(value));\n}\n\nfunction generateTopicClusters(keywordRecords, minClusterSize = 3) {\n    if (!keywordRecords || keywordRecords.length < minClusterSize) return {};\n    const clusters = {};\n    const sortedKeywords = [...keywordRecords].sort((a, b) => a.keyword.length - b.keyword.length);\n    const headTerms = new Set();\n\n    sortedKeywords.forEach(kwObj => {\n        const keyword = kwObj.keyword.toLowerCase();\n        if (keyword.split(' ').length <= 3 && (kwObj.standard?.search_volume || 0) >= 50) {\n            let isSubTerm = false;\n            for (const head of headTerms) {\n                if (head.includes(keyword)) {\n                    isSubTerm = true;\n                    break;\n                }\n            }\n            if (!isSubTerm) {\n                headTerms.add(keyword);\n                clusters[keyword] = [];\n            }\n        }\n    });\n    \n    sortedKeywords.forEach(kwObj => {\n        const keyword = kwObj.keyword.toLowerCase();\n        let bestMatch = '';\n        for (const head of headTerms) {\n            if (keyword.includes(head) && keyword !== head) {\n                if (head.length > (bestMatch.length || 0)) {\n                    bestMatch = head;\n                }\n            }\n        }\n        if (bestMatch) {\n            clusters[bestMatch].push(kwObj);\n        }\n    });\n\n    for (const head in clusters) {\n        if (clusters[head].length < (minClusterSize - 1)) {\n            delete clusters[head];\n        }\n    }\n    return clusters;\n}\n\n\n// --- MAIN FUNCTION TO BUILD THE HTML DOCUMENT ---\nfunction generateReport(data) {\n    const {\n        primary_keyword_record,\n        keyword_records,\n        lightweight_ideas,\n        serp_google_compact,\n        serp_youtube_compact,\n        ai_mode_data_compact,\n        competitor_urls\n    } = data;\n\n    const canonicalizeUrl = (url) => (url ? url.split('#')[0] : '');\n    const aiSourcesSet = new Set((ai_mode_data_compact.authoritative_sources || []).map(canonicalizeUrl).filter(Boolean));\n    const aiSources = Array.from(aiSourcesSet);\n    const organicCompetitors = (competitor_urls || []).map(canonicalizeUrl).filter(url => url && !aiSourcesSet.has(url));\n    const uniqueOrganicCompetitors = Array.from(new Set(organicCompetitors));\n    const topicClusters = generateTopicClusters(keyword_records);\n\n    const styles = `\n    <style>\n        :root{--bg-primary:#111827;--bg-secondary:#1F2937;--bg-tertiary:#374151;--text-primary:#F9FAFB;--text-secondary:#D1D5DB;--accent-blue:#3B82F6;--accent-green:#10B981;--border-color:#374151;--font-body:'Inter',sans-serif;--font-heading:'Poppins',sans-serif;--json-key:#9CDCFE;--json-string:#CE9178;--json-number:#B5CEA8;--json-boolean:#569CD6;--json-null:#D1D5DB}body.light-mode{--bg-primary:#fff;--bg-secondary:#F3F4F6;--bg-tertiary:#E5E7EB;--text-primary:#111827;--text-secondary:#374151;--border-color:#D1D5DB;--json-key:#00f;--json-string:#A31515;--json-number:#098658;--json-boolean:#00f;--json-null:#808080}html{scroll-behavior:smooth}body{background-color:var(--bg-primary);color:var(--text-primary);font-family:var(--font-body);margin:0;padding:0;line-height:1.6}.container{display:grid;grid-template-columns:1fr;grid-template-areas:\"header\" \"nav\" \"main\"}@media (min-width:1024px){.container{grid-template-columns:280px 1fr;grid-template-areas:\"nav header\" \"nav main\"}}header{grid-area:header;padding:1rem 1.5rem;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center}nav{grid-area:nav;padding:1rem;border-bottom:1px solid var(--border-color);background-color:var(--bg-primary)}@media (min-width:1024px){nav{position:sticky;top:0;height:100vh;border-bottom:none;border-right:1px solid var(--border-color);padding:2rem;overflow-y:auto}}main{grid-area:main;padding:1.5rem;max-width:1200px;margin:0 auto;width:100%}section{margin-bottom:4rem;scroll-margin-top:2rem}h1,h2,h3{font-family:var(--font-heading);font-weight:700;margin-top:0;color:var(--text-primary)}h1{font-size:2rem}h2{font-size:1.75rem;color:var(--accent-blue);border-bottom:2px solid var(--border-color);padding-bottom:.5rem;margin-bottom:2rem}h3{font-size:1.25rem;color:var(--accent-green);margin-bottom:1.5rem}a{color:var(--accent-blue);text-decoration:none}a:hover{text-decoration:underline}code{background-color:var(--bg-tertiary);padding:.2em .4em;border-radius:4px;font-family:monospace;color:var(--text-primary)}.nav-title{font-size:1.2rem;font-weight:600;margin-bottom:1rem}nav ul{list-style:none;padding:0;margin:0;display:flex;flex-wrap:wrap;gap:.5rem}@media (min-width:1024px){nav ul{display:block}}nav li a{display:block;color:var(--text-secondary);padding:.5rem 1rem;border-radius:6px;border-left:3px solid transparent;transition:all .2s ease-in-out}nav li a:hover,nav li a.active{color:var(--text-primary);background-color:var(--bg-tertiary);border-left-color:var(--accent-blue)}.card{background-color:var(--bg-secondary);border:1px solid var(--border-color);border-radius:12px;padding:1.5rem;margin-bottom:1.5rem}.grid-2,.grid-3{display:grid;gap:1.5rem}.grid-2{grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}.grid-3{grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}table{width:100%;border-collapse:collapse;margin-top:1.5rem;color:var(--text-secondary)}th,td{padding:.75rem 1rem;text-align:left;border-bottom:1px solid var(--border-color);vertical-align:top}th{background-color:var(--bg-tertiary);font-weight:600;color:var(--text-primary)}th.sortable{cursor:pointer;-webkit-user-select:none;user-select:none}th.sortable:hover{background-color:var(--border-color)}th .sort-icon{margin-left:8px;color:var(--text-secondary);display:inline-block;width:10px}.ai-takeaway table{margin-top:1em}.ai-takeaway th,.ai-takeaway td{border:1px solid var(--border-color);padding:.5em}.header-controls{display:flex;align-items:center;gap:1rem}.control-button{background:var(--bg-secondary);border:1px solid var(--border-color);color:var(--text-primary);padding:.5rem 1rem;border-radius:6px;cursor:pointer}.table-controls{display:flex;flex-wrap:wrap;gap:1rem;justify-content:space-between;align-items:center;margin-bottom:1rem}.table-advanced-filters{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center}.table-advanced-filters label{font-size:.8em;margin-right:.25rem}.table-advanced-filters input,.table-advanced-filters select{background-color:var(--bg-primary);border:1px solid var(--border-color);color:var(--text-primary);border-radius:6px;padding:.4rem;font-size:.9em}.table-pagination-controls{display:flex;justify-content:flex-end;align-items:center;gap:.5rem;margin-top:1rem;font-size:.9em}.pagination-button{padding:.3rem .6rem}.pagination-button:disabled{opacity:.5;cursor:not-allowed}#back-to-top{position:fixed;bottom:20px;right:20px;display:none;background-color:var(--accent-blue);color:#fff;border:none;border-radius:50%;width:50px;height:50px;font-size:24px;cursor:pointer;z-index:1000}.stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;margin-top:1.5rem}.stat-card{background-color:var(--bg-primary);padding:1.5rem;border-radius:8px;text-align:center;border:1px solid var(--border-color)}.stat-card-title{font-size:.9rem;color:var(--text-secondary)}.stat-card-value{font-size:2rem;font-weight:700}blockquote{border-left:4px solid var(--bg-tertiary);padding-left:1rem;margin-left:0;font-style:italic;color:var(--text-secondary)}.serp-feature-tag{background-color:var(--bg-tertiary);color:var(--text-primary);padding:.2em .6em;border-radius:12px;font-size:.8em;margin-right:.5em;display:inline-block;margin-top:.25em}.cluster-card{padding:1rem;cursor:pointer;transition:transform .2s}.cluster-card:hover{transform:translateY(-5px);border-color:var(--accent-green)}.cluster-card h3{font-size:1.1rem;color:var(--accent-green);margin-bottom:.5rem}.cluster-card ul{padding-left:20px;margin:0}.cluster-card li{font-size:.9em}.json-tree{font-family:monospace;font-size:.9em;list-style:none;padding:0}.json-tree-nested{display:none;list-style:none;padding-left:20px}.json-tree li{position:relative}.json-tree li.expanded>.json-tree-nested{display:block}.json-key{color:var(--json-key)}.json-string{color:var(--json-string)}.json-number{color:var(--json-number)}.json-boolean{color:var(--json-boolean)}.json-null{color:var(--json-null)}.json-toggle{cursor:pointer;-webkit-user-select:none;user-select:none;position:absolute;left:-15px;top:0;width:1em;text-align:center}.json-tree li.expanded>.json-toggle{content:'âˆ’'}@media print{body{background-color:#fff!important;color:#000!important}nav,header,#back-to-top,.table-controls{display:none!important}.container{display:block!important}.card{border:1px solid #ddd;box-shadow:none;page-break-inside:avoid}details{page-break-inside:avoid}details[open] summary{display:none}}\n    </style>\n    `;\n\n    const body = `\n    <body>\n      <div class=\"container\">\n        <nav>\n          <div class=\"nav-title\">Keyword Report</div>\n          <ul>\n            <li><a href=\"#overview\">1. Overview</a></li><li><a href=\"#keywords\">2. Keywords</a></li><li><a href=\"#clusters\">3. Topic Clusters</a></li><li><a href=\"#serp\">4. SERP</a></li><li><a href=\"#ai\">5. AI Insights</a></li><li><a href=\"#competitors\">6. Competitors</a></li><li><a href=\"#youtube\">7. YouTube</a></li><li><a href=\"#appendix\">8. Appendix</a></li>\n          </ul>\n        </nav>\n        <div>\n          <header><h1>Keyword Report</h1><div class=\"header-controls\"><button id=\"print-button\" class=\"control-button\">Print</button><button id=\"theme-toggle\" class=\"control-button\">Theme</button></div></header>\n          <main>\n            <section id=\"overview\">\n              <h2>1. Overview & Trends</h2>\n              <div class=\"card\">\n                <h3>Primary Keyword: <code>${escapeHtml(primary_keyword_record.keyword)}</code></h3>\n                <div class=\"stat-grid\">\n                  <div class=\"stat-card\"><div class=\"stat-card-title\">Search Volume</div><div class=\"stat-card-value\">${(primary_keyword_record.standard?.search_volume || 0).toLocaleString()}</div></div>\n                  <div class=\"stat-card\"><div class=\"stat-card-title\">AI Search Volume</div><div class=\"stat-card-value\">${(primary_keyword_record.ai?.ai_search_volume || 0).toLocaleString()}</div></div>\n                  <div class=\"stat-card\"><div class=\"stat-card-title\">Keyword Difficulty</div><div class=\"stat-card-value\">${primary_keyword_record.standard?.keyword_difficulty ?? 'N/A'}</div></div>\n                  <div class=\"stat-card\"><div class=\"stat-card-title\">CPC</div><div class=\"stat-card-value\">$${primary_keyword_record.standard?.cpc?.toFixed(2) ?? 'N/A'}</div></div>\n                </div>\n              </div>\n              <div class=\"card\" id=\"chart-card\"><canvas id=\"monthlySearchesChart\"></canvas></div>\n            </section>\n\n            <section id=\"keywords\">\n              <h2>2. All Keyword Opportunities</h2>\n              <div class=\"card grid-2\">\n                  <div><h3>Intent Distribution</h3><canvas id=\"intentChart\"></canvas></div>\n                  <div><h3>Difficulty Distribution</h3><canvas id=\"difficultyChart\"></canvas></div>\n              </div>\n              <div class=\"card\">\n                <details><summary><strong>View & Filter Full Keyword List (${(keyword_records || []).length} keywords)</strong></summary><div class=\"details-content\">\n                  <div class=\"table-controls\">\n                      <div class=\"table-advanced-filters\">\n                          <input type=\"search\" id=\"search-input\" placeholder=\"Search...\">\n                          <input type=\"number\" id=\"min-vol-input\" placeholder=\"Min Vol\">\n                          <input type=\"number\" id=\"max-vol-input\" placeholder=\"Max Vol\">\n                          <input type=\"number\" id=\"max-kd-input\" placeholder=\"Max KD\">\n                          <select id=\"intent-select\"><option value=\"\">All Intents</option></select>\n                      </div>\n                       <button class=\"control-button\" id=\"export-csv-button\">Export CSV</button>\n                  </div>\n                  <table class=\"interactive-table\">\n                    <thead><tr>\n                      <th class=\"sortable\" data-column-key=\"keyword\">Keyword<span class=\"sort-icon\"></span></th>\n                      <th class=\"sortable\" data-column-key=\"standard.search_volume\" data-type=\"number\">Volume<span class=\"sort-icon\"></span></th>\n                      <th class=\"sortable\" data-column-key=\"standard.keyword_difficulty\" data-type=\"number\">KD<span class=\"sort-icon\"></span></th>\n                      <th class=\"sortable\" data-column-key=\"standard.cpc\" data-type=\"number\">CPC<span class=\"sort-icon\"></span></th>\n                      <th class=\"sortable\" data-column-key=\"main_intent\">Intent<span class=\"sort-icon\"></span></th>\n                      <th class=\"sortable\" data-column-key=\"standard.last_12_months_trend\">12-Month Trend<span class=\"sort-icon\"></span></th>\n                    </tr></thead>\n                    <tbody></tbody>\n                  </table>\n                  <div class=\"table-pagination-controls\"></div>\n                </div></details>\n              </div>\n              <div class=\"card\">\n                <details><summary><strong>View Lightweight Keyword Ideas (${(lightweight_ideas || []).length} keywords)</strong></summary><div class=\"details-content\">\n                  ${formatListToHtml(lightweight_ideas, 'lightweight-item')}\n                </div></details>\n              </div>\n            </section>\n\n            <section id=\"clusters\">\n                <h2>3. Topic Clusters <button id=\"clear-cluster-filter\" class=\"control-button\" style=\"font-size: 0.7em; padding: 0.2em 0.5em; display: none;\">Clear</button></h2>\n                <div class=\"grid-3\" id=\"topic-cluster-grid\">\n                ${Object.keys(topicClusters).length > 0 ? Object.keys(topicClusters).map(head => `\n                    <div class=\"card cluster-card\" data-cluster-keyword=\"${escapeHtml(head)}\">\n                        <h3><code>${escapeHtml(head)}</code></h3>\n                        <ul>${topicClusters[head].slice(0, 5).map(kw => `<li>${escapeHtml(kw.keyword)}</li>`).join('')}</ul>\n                        ${topicClusters[head].length > 5 ? `<small>...and ${topicClusters[head].length - 5} more.</small>` : ''}\n                    </div>\n                `).join('') : '<p>No significant topic clusters identified.</p>'}\n                </div>\n            </section>\n            \n            <section id=\"serp\">\n              <h2>4. Google SERP Analysis</h2>\n              <div class=\"card\">\n                  <h3>Analysis</h3>\n                  <blockquote>${escapeHtml(serp_google_compact.inferred_user_psychology || 'N/A')}</blockquote>\n                  ${(serp_google_compact.serp_features && serp_google_compact.serp_features.length > 0) ? `\n                  <div style=\"margin-top: 1rem;\"><strong>SERP Features:</strong><br>\n                      ${serp_google_compact.serp_features.map(f => `<span class=\"serp-feature-tag\">${escapeHtml(f)}</span>`).join('')}\n                  </div>` : ''}\n              </div>\n              <div class=\"grid-2\">\n                <div class=\"card\"><h3>People Also Ask</h3>${formatListToHtml(serp_google_compact.paa_questions)}</div>\n                <div class=\"card\"><h3>Related Searches</h3>${formatListToHtml(serp_google_compact.related_searches)}</div>\n              </div>\n            </section>\n            \n            <section id=\"ai\">\n              <h2>5. AI Insights</h2>\n              <div class=\"card\">\n                <h3>AI Overview Key Takeaway</h3>\n                <div class=\"ai-takeaway\" data-markdown-source=\"${escapeHtml(ai_mode_data_compact.key_takeaway || '')}\"></div>\n              </div>\n            </section>\n\n            <section id=\"competitors\">\n              <h2>6. Competitor Analysis</h2>\n              <div class=\"grid-2\">\n                <div class=\"card\"><h3>AI-Cited Sources</h3>${formatListWithLinks(aiSources)}</div>\n                <div class=\"card\"><h3>Other Organic Competitors</h3>${formatListWithLinks(uniqueOrganicCompetitors)}</div>\n              </div>\n            </section>\n\n            <section id=\"youtube\">\n              <h2>7. YouTube Insights</h2>\n              <div class=\"card\"><h3>Top YouTube Videos</h3>\n                <table><thead><tr><th>Title & Channel</th><th>Views</th></tr></thead><tbody>\n                  ${(serp_youtube_compact.videos_top20 || []).filter(v => v && v.title).map(video => `<tr>\n                    <td><a href=\"${escapeHtml(video.url)}\" target=\"_blank\" rel=\"noopener noreferrer\">${escapeHtml(video.title)}</a><br><small>${escapeHtml(video.channel)}</small></td>\n                    <td>${video.views.toLocaleString()}</td>\n                  </tr>`).join('')}\n                </tbody></table>\n              </div>\n            </section>\n\n            <section id=\"appendix\">\n              <h2>8. Raw Data Appendix</h2>\n              <div class=\"card\"><details><summary><strong>View Full JSON Input</strong></summary><div class=\"details-content\" id=\"json-viewer-container\">${buildJsonTreeHtml(data)}</div></details></div>\n            </section>\n          </main>\n        </div>\n      </div>\n      <button id=\"back-to-top\" title=\"Go to top\">â–²</button>\n    </body>\n    `;\n    \n    const script = `\n      <script>\n        // Immediately apply theme from localStorage to prevent flash\n        (function() {\n          const theme = localStorage.getItem('theme');\n          if (theme === 'light') document.body.classList.add('light-mode');\n        })();\n      </script>\n      <script>\n        document.addEventListener('DOMContentLoaded', function() {\n          const allRecords = ${JSON.stringify(keyword_records || [])};\n          const pkData = ${JSON.stringify(primary_keyword_record || {})};\n\n          // --- INITIALIZATIONS ---\n          const observer = new IntersectionObserver(entries=>{entries.forEach(e=>{if(e.isIntersecting){document.querySelectorAll('nav a').forEach(l=>{l.classList.toggle('active',l.getAttribute('href').substring(1)===e.target.id)})}})},{rootMargin:'-40% 0px -60% 0px'});\n          document.querySelectorAll('main section[id]').forEach(s=>observer.observe(s));\n          document.getElementById('theme-toggle').addEventListener('click',()=>{document.body.classList.toggle('light-mode');localStorage.setItem('theme',document.body.classList.contains('light-mode')?'light':'dark');location.reload();});\n          document.getElementById('print-button').addEventListener('click',()=>{document.querySelectorAll('details').forEach(d=>d.setAttribute('open',''));setTimeout(()=>window.print(),100);});\n          const backToTopBtn=document.getElementById('back-to-top');window.addEventListener('scroll',()=>{backToTopBtn.style.display=window.scrollY>300?'block':'none'});backToTopBtn.addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));\n          \n          const mdTarget = document.querySelector('.ai-takeaway');\n          if (mdTarget && window.marked) mdTarget.innerHTML = marked.parse(mdTarget.dataset.markdownSource || 'N/A');\n\n          // --- CHARTING FUNCTIONS ---\n          function calculateLinearRegression(data) {\n              const n = data.length;\n              if (n < 2) return { m: 0, b: data[0]?.y || 0 };\n              let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;\n              data.forEach((point, i) => {\n                  sumX += i;\n                  sumY += point;\n                  sumXY += i * point;\n                  sumXX += i * i;\n              });\n              const m = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);\n              const b = (sumY - m * sumX) / n;\n              return { m, b };\n          }\n          \n          function createTrendChart() {\n            try {\n              if (!pkData || !pkData.standard) return;\n              const std = (pkData.standard.monthly_searches||[]).slice().reverse();\n              const ai = (pkData.ai?.monthly_searches||[]).slice().reverse();\n              const labels=[...new Set([...std.map(d=>d.month),...ai.map(d=>d.month)])].sort((a,b)=>new Date('1 '+a.replace(/'/,' 20'))-new Date('1 '+b.replace(/'/,' 20')));\n              const stdData=labels.map(l=>std.find(d=>d.month===l)?.volume??null);\n              const aiData=labels.map(l=>ai.find(d=>d.month===l)?.volume??null);\n\n              const trendData = stdData.map((d, i) => d === null ? (stdData[i-1] || stdData[i+1] || 0) : d);\n              const regression = calculateLinearRegression(trendData);\n              const trendlineData = trendData.map((_, i) => regression.m * i + regression.b);\n\n              const ctx=document.getElementById('monthlySearchesChart').getContext('2d');\n              const isLight=document.body.classList.contains('light-mode'), txtC=isLight?'#111827':'#F9FAFB', grdC=isLight?'#E5E7EB':'#374151';\n              \n              new Chart(ctx,{type:'line',data:{labels,datasets:[\n                  {label:'Standard Volume',data:stdData,borderColor:'#3B82F6',backgroundColor:'rgba(59,130,246,0.1)',fill:true,tension:0.4},\n                  {label:'AI Volume',data:aiData,borderColor:'#10B981',backgroundColor:'rgba(16,185,129,0.1)',fill:true,tension:0.4},\n                  {label:'Trend',data:trendlineData,borderColor:'#EF4444',borderDash:[5,5],fill:false,pointRadius:0}\n              ]},options:{responsive:true,plugins:{legend:{labels:{color:txtC}},title:{display:true,text:'Monthly Search Volume Trend',color:txtC}},scales:{y:{ticks:{color:txtC},grid:{color:grdC}},x:{ticks:{color:txtC},grid:{color:grdC}}}}});\n            } catch(e) { console.error('Trend Chart Error:', e); }\n          }\n          \n          function createDonutChart(canvasId, data, key) {\n              const counts=data.reduce((acc,item)=>{const v=item[key]||'N/A';if(Array.isArray(v)){v.forEach(v=>{acc[v]=(acc[v]||0)+1})}else{acc[v]=(acc[v]||0)+1}return acc},{});\n              const chartData={labels:Object.keys(counts),datasets:[{data:Object.values(counts),backgroundColor:['#3B82F6','#10B981','#F59E0B','#EF4444','#8B5CF6','#6B7280']}]};\n              const ctx=document.getElementById(canvasId)?.getContext('2d');if(!ctx)return;\n              const txtC=document.body.classList.contains('light-mode')?'#111827':'#F9FAFB';\n              new Chart(ctx,{type:'doughnut',data:chartData,options:{responsive:true,plugins:{legend:{position:'top',labels:{color:txtC}},title:{display:false}}}});\n          }\n          \n          function createDifficultyBarChart(canvasId, data) {\n              const buckets={'0-10 (Very Easy)':0,'11-30 (Easy)':0,'31-50 (Medium)':0,'51-70 (Hard)':0,'71+ (Very Hard)':0};\n              data.forEach(item=>{const kd=item.standard?.keyword_difficulty;if(kd<=10)buckets['0-10 (Very Easy)']++;else if(kd<=30)buckets['11-30 (Easy)']++;else if(kd<=50)buckets['31-50 (Medium)']++;else if(kd<=70)buckets['51-70 (Hard)']++;else buckets['71+ (Very Hard)']++;});\n              const chartData={labels:Object.keys(buckets),datasets:[{label:'# of Keywords',data:Object.values(buckets),backgroundColor:'rgba(59, 130, 246, 0.5)'}]};\n              const ctx=document.getElementById(canvasId)?.getContext('2d');if(!ctx)return;\n              const txtC=document.body.classList.contains('light-mode')?'#111827':'#F9FAFB',grdC=document.body.classList.contains('light-mode')?'#E5E7EB':'#374151';\n              new Chart(ctx,{type:'bar',data:chartData,options:{indexAxis:'y',responsive:true,plugins:{legend:{display:false}},scales:{y:{ticks:{color:txtC}},x:{ticks:{color:txtC},grid:{color:grdC}}}}});\n          }\n          \n          function makeTableInteractive() {\n              const table=document.querySelector('.interactive-table'); if(!table) return;\n              const tbody=table.querySelector('tbody'), headers=Array.from(table.querySelectorAll('th.sortable'));\n              let currentData=[...allRecords], currentPage=1, rowsPerPage=10, currentSort={key:'standard.search_volume', dir:'desc'};\n              const C={s:document.getElementById('search-input'),minV:document.getElementById('min-vol-input'),maxV:document.getElementById('max-vol-input'),maxK:document.getElementById('max-kd-input'),intent:document.getElementById('intent-select'),pagination:document.querySelector('.table-pagination-controls'),exportBtn:document.getElementById('export-csv-button')};\n              \n              const render=()=>{\n                  applySort();\n                  const start=(currentPage-1)*rowsPerPage, end=start+rowsPerPage;\n                  tbody.innerHTML=currentData.slice(start,end).map(row => {\n                    return \\`<tr>\\${headers.map(th => {\n                      const k = th.dataset.columnKey;\n                      let d = k.split('.').reduce((o, i) => o && o[i], row);\n                      \n                      if (d == null) { d = 'N/A'; }\n                      \n                      if (k === 'standard.cpc' && typeof d === 'number') { d = '$' + d.toFixed(2); }\n\n                      return \\`<td>\\${k === 'keyword' ? \\`<code>\\${d}</code>\\` : d}</td>\\`;\n                    }).join('')}</tr>\\`;\n                  }).join('');\n                  updatePaginationUI();\n              };\n\n              const updatePaginationUI=()=>{const tP=Math.ceil(currentData.length/rowsPerPage)||1;C.pagination.innerHTML=\\`<span>Rows: <select id=\"rows-per-page\"><option>10</option><option>25</option><option>50</option><option>100</option></select></span> <span>Page \\${currentPage} of \\${tP}</span> <button class=\"control-button pagination-button\" id=\"first-page\">Â«</button> <button class=\"control-button pagination-button\" id=\"prev-page\">â€¹</button> <button class=\"control-button pagination-button\" id=\"next-page\">â€º</button> <button class=\"control-button pagination-button\" id=\"last-page\">Â»</button>\\`;document.getElementById('rows-per-page').value=rowsPerPage;['first-page','prev-page'].forEach(id=>document.getElementById(id).disabled=currentPage===1);['next-page','last-page'].forEach(id=>document.getElementById(id).disabled=currentPage>=tP)};\n              \n              const applyFilters=()=>{const sT=C.s.value.toLowerCase(),minV=parseFloat(C.minV.value)||0,maxV=parseFloat(C.maxV.value)||Infinity,maxK=parseFloat(C.maxK.value)||Infinity,intent=C.intent.value;currentData=allRecords.filter(r=>{const v=r.standard?.search_volume??0,k=r.standard?.keyword_difficulty??0;return(sT===''||JSON.stringify(r).toLowerCase().includes(sT))&&v>=minV&&v<=maxV&&k<=maxK&&(intent===''||r.main_intent===intent)});currentPage=1;render()};\n              \n              const applySort=()=>{const{key,dir}=currentSort;const type=headers.find(h=>h.dataset.columnKey===key)?.dataset.type;currentData.sort((a,b)=>{let vA=key.split('.').reduce((o,i)=>o&&o[i],a),vB=key.split('.').reduce((o,i)=>o&&o[i],b);if(type==='number'){vA=parseFloat(vA)??-Infinity;vB=parseFloat(vB)??-Infinity}else{vA=String(vA||'').toLowerCase();vB=String(vB||'').toLowerCase()}return(vA<vB?-1:vA>vB?1:0)*(dir==='asc'?1:-1)})};\n              \n              const exportToCsv=()=>{const headerKeys=headers.map(h=>h.dataset.columnKey);const headerNames=headers.map(h=>h.textContent.replace('â–²','').replace('â–¼',''));let csvContent=\"data:text/csv;charset=utf-8,\"+headerNames.join(\",\")+\"\\\\n\";csvContent+=currentData.map(row=>headerKeys.map(key=>{let val=key.split('.').reduce((o,i)=>o&&o[i],row);if(val==null)val=\"N/A\";if(Array.isArray(val))val=val.join('; ');val=String(val||'').replace(/\"/g,'\"\"');return\\`\"\\${val}\"\\`}).join(\",\")).join(\"\\\\n\");const encodedUri=encodeURI(csvContent);const link=document.createElement(\"a\");link.setAttribute(\"href\",encodedUri);link.setAttribute(\"download\",\"keyword_export.csv\");document.body.appendChild(link);link.click();link.remove()};\n\n              Object.values(C).filter(el=>el&&el!==C.pagination&&el!==C.exportBtn).forEach(el=>el.addEventListener('input',applyFilters));\n              C.pagination.addEventListener('click',e=>{const tP=Math.ceil(currentData.length/rowsPerPage);const id=e.target.id;if(id==='first-page')currentPage=1;if(id==='prev-page'&&currentPage>1)currentPage--;if(id==='next-page'&&currentPage<tP)currentPage++;if(id==='last-page')currentPage=tP;render()});\n              C.pagination.addEventListener('change',e=>{if(e.target.id==='rows-per-page'){rowsPerPage=parseInt(e.target.value,10);currentPage=1;render()}});\n              headers.forEach(h=>h.addEventListener('click',()=>{const key=h.dataset.columnKey;currentSort.dir=(currentSort.key===key&&currentSort.dir==='asc')?'desc':'asc';currentSort.key=key;headers.forEach(th=>{th.querySelector('.sort-icon').textContent=''});h.querySelector('.sort-icon').textContent=currentSort.dir==='asc'?'â–²':'â–¼';currentPage=1;render()}));\n              C.exportBtn.addEventListener('click', exportToCsv);\n              \n              const intents=[...new Set(allRecords.map(r=>r.main_intent).filter(Boolean))];\n              intents.forEach(i=>C.intent.innerHTML+=\\`<option value=\"\\${i}\">\\${i}</option>\\`);\n              \n              applyFilters();\n          }\n          \n          // --- OTHER INITIALIZATIONS ---\n          createTrendChart();\n          createDonutChart('intentChart', allRecords, 'main_intent');\n          createDifficultyBarChart('difficultyChart', allRecords);\n          makeTableInteractive();\n\n          document.getElementById('topic-cluster-grid').addEventListener('click', e => {\n              const card = e.target.closest('.cluster-card');\n              if (card) {\n                  const keyword = card.dataset.clusterKeyword;\n                  document.getElementById('search-input').value = keyword;\n                  document.getElementById('search-input').dispatchEvent(new Event('input'));\n                  document.getElementById('clear-cluster-filter').style.display = 'inline-block';\n                  document.querySelector('#keywords details').open = true;\n                  card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n              }\n          });\n          document.getElementById('clear-cluster-filter').addEventListener('click', e => {\n              document.getElementById('search-input').value = '';\n              document.getElementById('search-input').dispatchEvent(new Event('input'));\n              e.target.style.display = 'none';\n          });\n          \n          document.getElementById('json-viewer-container').addEventListener('click', e => {if(e.target.classList.contains('json-toggle')){const p=e.target.parentElement;p.classList.toggle('expanded');e.target.textContent=p.classList.contains('expanded')?'âˆ’':'+'}});\n        });\n      </script>\n    `;\n    \n    return `<!DOCTYPE html><html lang=\"en\"><head><meta charset=\"UTF-8\"><title>Keyword Research Report: ${escapeHtml(primary_keyword_record.keyword)}</title><script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script><script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"></script><link rel=\"preconnect\" href=\"https://fonts.googleapis.com\"><link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin><link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Poppins:wght@600;700&display=swap\" rel=\"stylesheet\">${styles}</head>${body}${script}</html>`;\n}\n\n// --- FINAL EXECUTION ---\nreturn [\n  {\n    json: {\n      html_report: generateReport(data)\n    }\n  },\n  {\n    json: data\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        8656,
        -448
      ],
      "id": "93945e99-05c9-4fa0-a1a8-f34038c1714d",
      "name": "Keyword Research Report Synthesizer"
    },
    {
      "parameters": {
        "jsCode": "// The cache_content is a stringified JSON array with one object inside.\nconst cacheContentString = $('Get Cache').first().json.cache_content;\n\n// Use a try-catch block for robust parsing. This prevents workflow failure\n// if the cache_content is ever malformed or empty.\ntry {\n  // 1. Parse the string into a JavaScript array.\n  const parsedArray = JSON.parse(cacheContentString);\n  \n  // 2. Extract the first (and only) object from the array.\n  const resultObject = parsedArray[0];\n\n  // 3. Return the extracted object as the new output.\n  // This replaces the old structure with the clean, parsed object.\n  return [{ json: resultObject }];\n\n} catch (error) {\n  // If parsing fails, throw an error to halt the workflow and trigger error handling.\n  throw new Error(`Failed to parse cache_content. Error: ${error.message}`);\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4752,
        -448
      ],
      "id": "66df284f-54f6-4497-9030-ef5ff2921313",
      "name": "Get data from Cache"
    },
    {
      "parameters": {
        "jsCode": "// Get the full JSON object from the input item.\nconst finalDataObject = $input.first().json.normalize_keyword_research_data;\n\n// Serialize the entire object into a nicely formatted string.\n// The 'null, 2' arguments make the string human-readable (pretty-printed with 2-space indents).\n// For maximum compactness, you can use JSON.stringify(finalDataObject).\nconst jsonString = JSON.stringify(finalDataObject, null, 2);\n\n// Create a new item that contains ONLY the serialized string,\n// ready for insertion into a single database/sheet column.\nreturn [\n  {\n    json: {\n      serialized_research_data: jsonString\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        7200,
        192
      ],
      "id": "a1756dcc-d61f-495e-9c80-464745a4fcbe",
      "name": "Convert Json to String"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Final KW Payload').item.json.final_kw_data_payload[0].send_to_email }}",
        "subject": "=Keyword Research is ready - {{ $('Final KW Payload').item.json.final_kw_data_payload[0].keyword }}",
        "emailType": "text",
        "message": "=Hi there,\n\nThe content's all set! ðŸŽ‰ It's ready for your review.\nCheck it out! I hope you like it ^_^\n\n    * ðŸŒ Keyword Research in S3 (html):\n{{ $json.html_research_report_pub }}\n\n    * ðŸŒ Keyword Research in Google Drive (html):\n{{ $json.html_research_report_drive }}\n\nBest Regards,\nKW_Research@SEVOsmith",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        10320,
        416
      ],
      "id": "9402ec7e-10a9-4f39-8a47-4b869e122845",
      "name": "Send a message",
      "webhookId": "3c6ed862-6102-4198-b5ac-845930f7ad45",
      "credentials": {
        "gmailOAuth2": {
          "id": "7k1q2a9SLMZEECC6",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "83e1e91d-4b86-4ae6-8866-cf358592dcaa",
              "name": "html_research_report_drive",
              "value": "={{ $('Restore State').item.json[\"Report in G-drive\"] }}",
              "type": "string"
            },
            {
              "id": "af792dfd-6877-4d96-8808-816b2119b32c",
              "name": "html_research_report_pub",
              "value": "={{ $('Restore State').item.json[\"Report in Cloudflade R2\"] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        10016,
        416
      ],
      "id": "75a7ae6a-4df3-4084-8348-fc571fa0cc14",
      "name": "Prepare Email"
    },
    {
      "parameters": {
        "operation": "upload",
        "bucketName": "n8n-bucket",
        "fileName": "=article/{{ $('Final KW Payload').item.json.final_kw_data_payload[0].normalize_kw }}__keyword_research.html",
        "binaryData": false,
        "fileContent": "={{ $('Final KW Payload').item.json.final_kw_data_payload[1].html_report }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.s3",
      "typeVersion": 1,
      "position": [
        9712,
        -272
      ],
      "id": "2f374c27-1f33-4652-ad25-5c97e88b199f",
      "name": "Upload HTML Report S3",
      "credentials": {
        "s3": {
          "id": "6oqvP8lMY8tPpAFs",
          "name": "S3 account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://www.googleapis.com/upload/drive/v3/files",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDriveOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "uploadType",
              "value": "multipart"
            },
            {
              "name": "supportsAllDrives",
              "value": "true"
            }
          ]
        },
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "=multipart/related; boundary=divider",
        "body": "=--divider\nContent-Type: application/json; charset=UTF-8\n\n{\n  \"name\": \"{{ $json.final_kw_data_payload[0].normalize_kw }}__keyword_research.html\",\n  \"mimeType\": \"text/html\",\n  \"parents\": [\n    \"{{ $json.final_kw_data_payload[0].google_drive_folder }}\"\n  ]\n}\n\n--divider\nContent-Type: text/html\n\n{{ $json.final_kw_data_payload[1].html_report }}\n\n--divider--",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        9696,
        -640
      ],
      "id": "869de808-d4cd-4b8e-8de3-5471fca07fce",
      "name": "Upload Keyword Research Report G-drive",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "sldlKM4CMS0lIS4K",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6ca238f9-1eec-4fba-83d4-b94e5e17a838",
              "leftValue": "={{ $('Restore State').item.json.user_input_data.email_notify }}",
              "rightValue": "Yes",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        9648,
        432
      ],
      "id": "b78ad0fe-43dc-466b-ba47-468f4b724492",
      "name": "If2"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "final_kw_data_payload",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        9104,
        -624
      ],
      "id": "f2c07b03-fd3a-41c9-8fb6-1ac3a7942e70",
      "name": "Final KW Payload"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a0e03572-4e6b-40fb-83c9-b3bbb94f02ba",
              "leftValue": "={{ $json.final_kw_data_payload[0].upload_drive }}",
              "rightValue": "Yes",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "d28efbf7-7944-4302-953d-f795d150fc2c",
              "leftValue": "",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        9344,
        -624
      ],
      "id": "5da635f4-488f-4906-95ea-9153b66e7021",
      "name": "Upload_Drive?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a0e03572-4e6b-40fb-83c9-b3bbb94f02ba",
              "leftValue": "={{ $json.final_kw_data_payload[0].upload_s3 }}",
              "rightValue": "Yes",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        9344,
        -256
      ],
      "id": "ff876a0a-0afc-48dc-b2cf-4c20c83e0eef",
      "name": "Upload_S3"
    },
    {
      "parameters": {
        "content": "# 6. Failure Notification\n\n**Objective:** Alert the team if any API call fails.\n\n*   **Collect Failures:** The `Set` node aggregates all errors from the API validation nodes.\n*   **Update Status:** Marks the job as `Error` in the control sheet with the specific error message.\n*   **Send Alert:** Dispatches a detailed failure email to the designated user.",
        "height": 1280,
        "width": 1600,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5680,
        928
      ],
      "id": "9c18e41e-74aa-401c-9ee6-93a527e90903",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8",
          "mode": "list",
          "cachedResultName": "SEVOsmith_Manager_Sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 484582664,
          "mode": "list",
          "cachedResultName": "Campaign Start",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit#gid=484582664"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Session ID": "={{ $('Final KW Payload').item.json.final_kw_data_payload[0].session_id }}",
            "Report in G-drive": "={{ $json.html_research_report_drive }}"
          },
          "matchingColumns": [
            "Session ID"
          ],
          "schema": [
            {
              "id": "Project",
              "displayName": "Project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Session ID",
              "displayName": "Session ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Keyword",
              "displayName": "Keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Action",
              "displayName": "Action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Report in G-drive",
              "displayName": "Report in G-drive",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Report in Cloudflade R2",
              "displayName": "Report in Cloudflade R2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Raw Data",
              "displayName": "Raw Data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Notes",
              "displayName": "Notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        10192,
        -640
      ],
      "id": "1b4ae7ec-77c4-4515-b4f4-9ffac97711bc",
      "name": "Update Report Link G-drive",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "auYpM9otybGTlYsx",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "af792dfd-6877-4d96-8808-816b2119b32c",
              "name": "html_research_report_pub",
              "value": "={{ $('Final KW Payload').item.json.final_kw_data_payload[0].s3_link_pub }}/article/{{ $('Final KW Payload').item.json.final_kw_data_payload[0].normalize_kw }}__keyword_research.html",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        9968,
        -272
      ],
      "id": "15060257-b768-4841-97ff-95c57c5d90de",
      "name": "Get Link S3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "83e1e91d-4b86-4ae6-8866-cf358592dcaa",
              "name": "html_research_report_drive",
              "value": "=https://drive.google.com/file/d/{{ $json.id }}/view?usp=sharing",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        9952,
        -640
      ],
      "id": "fa1cb967-5926-423e-ace5-ba83ef56ae34",
      "name": "Get Link G-Drive"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8",
          "mode": "list",
          "cachedResultName": "SEVOsmith_Manager_Sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 484582664,
          "mode": "list",
          "cachedResultName": "Campaign Start",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit#gid=484582664"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Session ID": "={{ $('Final KW Payload').item.json.final_kw_data_payload[0].session_id }}",
            "Report in Cloudflade R2": "={{ $json.html_research_report_pub }}"
          },
          "matchingColumns": [
            "Session ID"
          ],
          "schema": [
            {
              "id": "Project",
              "displayName": "Project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Session ID",
              "displayName": "Session ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Keyword",
              "displayName": "Keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Action",
              "displayName": "Action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Report in G-drive",
              "displayName": "Report in G-drive",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Report in Cloudflade R2",
              "displayName": "Report in Cloudflade R2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Raw Data",
              "displayName": "Raw Data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Notes",
              "displayName": "Notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        10208,
        -272
      ],
      "id": "b5b22f87-5c11-4344-8e44-6d418e4025a2",
      "name": "Update Report Link S3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "auYpM9otybGTlYsx",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        8880,
        -624
      ],
      "id": "0f4258d7-68c7-4689-943d-fd98c22ae76f",
      "name": "Consolidate Final Data"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "smda3oGWtU6DGepT",
          "mode": "list",
          "cachedResultName": "SEVOsmith_KW_Cache",
          "cachedResultUrl": "/projects/NDZtAl2Y5mdJzN72/datatables/smda3oGWtU6DGepT"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "cache_id",
              "keyValue": "={{ $('Set Input Data').item.json.cache_key }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        2544,
        1328
      ],
      "id": "9c7768f1-e599-4630-a8b3-d838a0b3ddac",
      "name": "Get Cache",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8",
          "mode": "list",
          "cachedResultName": "SEVOsmith_Manager_Sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 484582664,
          "mode": "list",
          "cachedResultName": "Campaign Start",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit#gid=484582664"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Keyword": "={{ $('Set Input Data').item.json.keyword }}",
            "Raw Data": "=https://docs.google.com/spreadsheets/d/{{ $('Google Drive Copy KW Template').item.json.id }}/view?usp=sharing",
            "Session ID": "={{ $('Set Input Data').item.json.session_id }}",
            "Execution ID": "={{ $('Set Input Data').item.json.workflow_execution_id }}"
          },
          "matchingColumns": [
            "Session ID"
          ],
          "schema": [
            {
              "id": "Project",
              "displayName": "Project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Session ID",
              "displayName": "Session ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Execution ID",
              "displayName": "Execution ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Keyword",
              "displayName": "Keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Action",
              "displayName": "Action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Report in G-drive",
              "displayName": "Report in G-drive",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Report in Cloudflade R2",
              "displayName": "Report in Cloudflade R2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Raw Data",
              "displayName": "Raw Data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Notes",
              "displayName": "Notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        7568,
        688
      ],
      "id": "88664041-b509-4707-bb3c-8bd89de28066",
      "name": "Update Link Raw Data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "auYpM9otybGTlYsx",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "dbba63fc-6aff-4636-8d8a-c13abe55671a",
              "name": "keyword",
              "value": "={{ $('Set Input Data').item.json.keyword }}",
              "type": "string"
            },
            {
              "id": "5f047570-bbb0-434d-8506-e699f3c85151",
              "name": "raw_keyword_research_data",
              "value": "={{ $json.raw_keyword_research_data }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        6128,
        192
      ],
      "id": "dfc235c9-751e-4667-ab45-40152fc9e863",
      "name": "Prepare for Normalization"
    },
    {
      "parameters": {
        "content": "# 4. Core Data Processing\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n**Objective:** Unify data from either the cache or live APIs, then generate the final HTML report.\n\nThis zone is the convergence point for both workflow paths.\n\n*   **Cache Miss Path Input:** Receives a large, aggregated object of fresh API data via the **`Normalize_and_Compact`** node.\n*   **Cache Hit Path Input:** Receives a stored JSON string, which is then parsed back into the complete data object by the **`Get data from Cache`** node.\n*   **Merge Data Sources:** Unifies the item from either the cache-hit or cache-miss path into a single, consistent stream.\n*   **Synthesizer:** Takes the unified data object and generates the self-contained HTML report, appending it to the object for downstream use.",
        "height": 1664,
        "width": 3120,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5680,
        -768
      ],
      "id": "4d4b22b4-63a8-43ea-81a6-ccf5230df10b",
      "name": "Sticky Note39"
    },
    {
      "parameters": {
        "content": "# 5. Output & Side-Effect",
        "height": 1664,
        "width": 2080,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        8816,
        -768
      ],
      "id": "1cd3ebc2-9c0a-4bf7-8743-ad94dd99bb38",
      "name": "Sticky Note25"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8",
          "mode": "list",
          "cachedResultName": "SEVOsmith_Manager_Sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 484582664,
          "mode": "list",
          "cachedResultName": "Campaign Start",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit#gid=484582664"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Session ID": "={{ $json.user_input_data.session_id }}",
            "Status": "Completed",
            "Notes": "Successful"
          },
          "matchingColumns": [
            "Session ID"
          ],
          "schema": [
            {
              "id": "Project",
              "displayName": "Project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Session ID",
              "displayName": "Session ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Keyword",
              "displayName": "Keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Action",
              "displayName": "Action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Report in G-drive",
              "displayName": "Report in G-drive",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Report in Cloudflade R2",
              "displayName": "Report in Cloudflade R2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Raw Data",
              "displayName": "Raw Data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Notes",
              "displayName": "Notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        9360,
        432
      ],
      "id": "6d58222a-dc1f-48b0-94fc-80ee5ff13b7b",
      "name": "Update Status \"Completed\"",
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "auYpM9otybGTlYsx",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "content": "# Get data from cache\n",
        "height": 560,
        "width": 1360
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4304,
        -784
      ],
      "id": "61eb7b5b-12a7-4a68-8d5c-e0796143d8d6",
      "name": "Sticky Note10"
    },
    {
      "parameters": {
        "content": "# 2. Caching & Routing\n\n**Objective:** Check for existing results to avoid redundant API calls.\n\n*   **Set Input Data:** Creates the primary `cache_key` and consolidates run parameters.\n*   **Get Cache:** Attempts to retrieve a result from the Data Table using the `cache_key`.\n*   **Cache Hit?:**\n    *   **True (Top Path):** Cache found. **Bypasses API calls (Zone 3)** and proceeds directly to **Data Processing (Zone 4)** to parse the cached data.\n    *   **False (Bottom Path):** No cache found. Proceeds to the **Live Data Fetching path (Zone 3)**.",
        "height": 656,
        "width": 928,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1968,
        848
      ],
      "id": "8c502d46-bb3d-4883-b337-9170414752ca",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "af2a5d86-7cdd-42f8-893b-4fd018a7aee1",
              "leftValue": "={{ $json.Action }}",
              "rightValue": "Submit",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "05090764-53ad-4429-a96a-e1818ad1acc3",
              "leftValue": "={{ $json.Status }}",
              "rightValue": "=To_Do",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        1280,
        1104
      ],
      "id": "0de14fbc-8adc-4318-847b-fa91ac6fc215",
      "name": "Filter"
    },
    {
      "parameters": {
        "content": "# 3. Live Data Fetching (Cache Miss Path)\n\n**Objective:** Execute all necessary DataForSEO API calls to gather raw data for the keyword.\n\nThis entire block only runs if no valid cache entry was found in Zone 2. It aggregates all API responses into a single object for processing.",
        "height": 3056,
        "width": 1360,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4304,
        -208
      ],
      "id": "0b5a7cc9-d74f-4cb2-af71-36b5f2df0e17",
      "name": "Sticky Note3"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        6752,
        -448
      ],
      "id": "e046239d-d584-49cb-8145-37dc2dbdbfa8",
      "name": "Merge Data Sources"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "93e216f3-c664-4c01-aafd-c2a1308356ae",
              "leftValue": "={{ $json.status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            },
            {
              "id": "bd2e1731-d7a4-4ae7-b346-58729326a6a6",
              "leftValue": "={{ $json.tasks[0].status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4656,
        64
      ],
      "id": "6f823cf9-3b36-47a0-bee4-66f21cce37ec",
      "name": "If"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8",
          "mode": "list",
          "cachedResultName": "SEVOsmith_Manager_Sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 484582664,
          "mode": "list",
          "cachedResultName": "Campaign Start",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit#gid=484582664"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Status": "Error",
            "Session ID": "={{ $('Set Input Data').item.json.session_id }}",
            "Notes": "=[{{ $json.response.tasks[0].data.api }}]: {{ $json.response.tasks[0].status_message }}"
          },
          "matchingColumns": [
            "Session ID"
          ],
          "schema": [
            {
              "id": "Project",
              "displayName": "Project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Session ID",
              "displayName": "Session ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Keyword",
              "displayName": "Keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Action",
              "displayName": "Action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Report in G-drive",
              "displayName": "Report in G-drive",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Report in Cloudflade R2",
              "displayName": "Report in Cloudflade R2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Raw Data",
              "displayName": "Raw Data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Notes",
              "displayName": "Notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        6096,
        1440
      ],
      "id": "813b322d-7f80-4f7b-9b4a-f9694c69596c",
      "name": "Update Status \"Error\"",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "auYpM9otybGTlYsx",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "errorMessage": "Error occured in Keyword Research Workflow!"
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        7136,
        1936
      ],
      "id": "65a8863c-3b27-44c1-ac5c-58138221f2c3",
      "name": "Stop and Error"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Set Input Data').item.json.send_to_email }}",
        "subject": "=[FAILURE] Keyword Research Workflow | Keyword: {{ $('Set Input Data').item.json.keyword }} | Session: {{ $('Set Input Data').item.json.session_id }}",
        "message": "=<div style=\"font-family: Arial, sans-serif; font-size: 14px; color: #333; line-height: 1.6;\">\n    <h3 style=\"color: #D32F2F; border-bottom: 1px solid #ccc; padding-bottom: 10px;\">Keyword Research Workflow Failure</h3>\n    <p>A failure was detected for keyword: <strong>{{ $('Set Input Data').item.json.keyword }}</strong></p>\n\n    <h4 style=\"margin-top: 25px; margin-bottom: 10px;\">Execution Details</h4>\n    <table style=\"width: 100%; border-collapse: collapse; font-size: 13px;\">\n        <tr style=\"border-bottom: 1px solid #eee;\">\n            <td style=\"padding: 8px; width: 150px; background-color: #f9f9f9;\"><strong>Timestamp (UTC):</strong></td>\n            <td style=\"padding: 8px;\">{{ new Date().toISOString() }}</td>\n        </tr>\n        <tr style=\"border-bottom: 1px solid #eee;\">\n            <td style=\"padding: 8px; background-color: #f9f9f9;\"><strong>Session ID:</strong></td>\n            <td style=\"padding: 8px;\"><code>{{ $('Set Input Data').item.json.session_id }}</code></td>\n        </tr>\n        <tr style=\"border-bottom: 1px solid #eee;\">\n            <td style=\"padding: 8px; background-color: #f9f9f9;\"><strong>Project:</strong></td>\n            <td style=\"padding: 8px;\">{{ $('Set Input Data').item.json.project }}</td>\n        </tr>\n    </table>\n\n    <h4 style=\"margin-top: 25px; margin-bottom: 10px;\">Error Details</h4>\n    <table style=\"width: 100%; border-collapse: collapse; font-size: 13px;\">\n        <tr style=\"border-bottom: 1px solid #eee;\">\n            <td style=\"padding: 8px; width: 150px; background-color: #f9f9f9;\"><strong>API:</strong></td>\n            <td style=\"padding: 8px;\">{{ $('Get Failed Response').item.json.response.tasks[0].data.api }}</td>\n        </tr>\n        <tr style=\"border-bottom: 1px solid #eee;\">\n            <td style=\"padding: 8px; background-color: #f9f9f9;\"><strong>Status Code:</strong></td>\n            <td style=\"padding: 8px;\"><code>{{ $('Get Failed Response').item.json.response.tasks[0].status_code }}</code></td>\n        </tr>\n        <tr style=\"border-bottom: 1px solid #eee;\">\n            <td style=\"padding: 8px; background-color: #f9f9f9;\"><strong>Message:</strong></td>\n            <td style=\"padding: 8px;\">{{ $('Get Failed Response').item.json.response.tasks[0].status_message }}</td>\n        </tr>\n    </table>\n\n    <p style=\"margin-top: 30px; font-size: 12px; color: #777;\"><em>-- KW_Research@SEVOsmith</em></p>\n</div>",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        6816,
        1424
      ],
      "id": "07520401-f2a3-474b-909d-421ed905117d",
      "name": "Send Email for Error Notification",
      "webhookId": "3c6ed862-6102-4198-b5ac-845930f7ad45",
      "credentials": {
        "gmailOAuth2": {
          "id": "7k1q2a9SLMZEECC6",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "518ce0da-7bd4-4a1e-ad91-74aafe98b093",
              "name": "response",
              "value": "={{ $json }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5792,
        1440
      ],
      "id": "11a2069b-49be-40af-a94a-825790032d0c",
      "name": "Get Failed Response"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "eb29db29-021c-4f66-986f-5060c1bc3a02",
              "leftValue": "={{ $('Set Input Data').item.json.email_notify }}",
              "rightValue": "Yes",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        6416,
        1440
      ],
      "id": "87d6e496-d177-4814-a91e-88c1569f141e",
      "name": "Notify On Error?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "93e216f3-c664-4c01-aafd-c2a1308356ae",
              "leftValue": "={{ $json.status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            },
            {
              "id": "bd2e1731-d7a4-4ae7-b346-58729326a6a6",
              "leftValue": "={{ $json.tasks[0].status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4656,
        384
      ],
      "id": "25d556b0-1d1e-4db0-b164-8584f6c2b193",
      "name": "If1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "93e216f3-c664-4c01-aafd-c2a1308356ae",
              "leftValue": "={{ $json.status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            },
            {
              "id": "bd2e1731-d7a4-4ae7-b346-58729326a6a6",
              "leftValue": "={{ $json.tasks[0].status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4656,
        688
      ],
      "id": "706e974e-0a6e-4a3c-a101-11b531927c49",
      "name": "If3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "93e216f3-c664-4c01-aafd-c2a1308356ae",
              "leftValue": "={{ $json.status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            },
            {
              "id": "bd2e1731-d7a4-4ae7-b346-58729326a6a6",
              "leftValue": "={{ $json.tasks[0].status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4656,
        1008
      ],
      "id": "61e784c4-b655-4155-a0c7-deeb2756f6ce",
      "name": "If4"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "93e216f3-c664-4c01-aafd-c2a1308356ae",
              "leftValue": "={{ $json.status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            },
            {
              "id": "bd2e1731-d7a4-4ae7-b346-58729326a6a6",
              "leftValue": "={{ $json.tasks[0].status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4656,
        1328
      ],
      "id": "3d29acf8-9819-4c7e-adae-c3adf0397059",
      "name": "If5"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "93e216f3-c664-4c01-aafd-c2a1308356ae",
              "leftValue": "={{ $json.status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            },
            {
              "id": "bd2e1731-d7a4-4ae7-b346-58729326a6a6",
              "leftValue": "={{ $json.tasks[0].status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4656,
        1648
      ],
      "id": "37db9b32-20f9-459d-9bac-7662ff2be319",
      "name": "If6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "93e216f3-c664-4c01-aafd-c2a1308356ae",
              "leftValue": "={{ $json.status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            },
            {
              "id": "bd2e1731-d7a4-4ae7-b346-58729326a6a6",
              "leftValue": "={{ $json.tasks[0].status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4656,
        1952
      ],
      "id": "fd27c4da-2e23-4470-ba60-7f4558494ac7",
      "name": "If7"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "93e216f3-c664-4c01-aafd-c2a1308356ae",
              "leftValue": "={{ $json.status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            },
            {
              "id": "bd2e1731-d7a4-4ae7-b346-58729326a6a6",
              "leftValue": "={{ $json.tasks[0].status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4656,
        2304
      ],
      "id": "f4415b27-6662-4db3-a2d6-5e6b0e9c28e4",
      "name": "If8"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "93e216f3-c664-4c01-aafd-c2a1308356ae",
              "leftValue": "={{ $json.status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            },
            {
              "id": "bd2e1731-d7a4-4ae7-b346-58729326a6a6",
              "leftValue": "={{ $json.tasks[0].status_code }}",
              "rightValue": 20000,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4656,
        2656
      ],
      "id": "3b7ebe4a-1485-4c0e-bfd6-a708fdded45e",
      "name": "If9"
    },
    {
      "parameters": {
        "content": "## SEVOsmith Keyword Research Engine ðŸ“Š\n\nThis workflow is a production-ready, automated system for performing comprehensive keyword research using a powerful suite of [DataForSEO API key](https://dataforseo.com/). It is designed to be triggered for a single keyword, fetch and process data from multiple endpoints, handle failures gracefully, cache results, and deliver a self-contained, interactive HTML report.\n\n### 1. Why This Setup is Useful ðŸš€\n\nThis workflow has evolved from a simple reference guide into a robust automation engine with key production-grade features:\n\n*   **Production-Ready:** A fully stateful system that knows what to process (`To_Do`), what's in progress (`Processing`), and what's done (`Completed`/`Error`).\n*   **Cost-Efficient & Idempotent:** The caching layer prevents redundant API calls for the same keyword, saving significant costs and time on repeated runs.\n*   **Resilient by Design:** A custom, granular error-handling branch catches, logs, and reports on any API failure without halting the entire workflow.\n*   **Actionable Deliverable:** The primary output is a self-contained, interactive HTML report that provides deep strategic insights and requires no external dependencies to view.\n*   **Excellent Learning Resource:** This workflow serves as an advanced template for n8n, demonstrating patterns for sub-workflows, state management, parallel processing, custom error handling, and data synthesis.\n\n### 2. How It Works: The Core Loop\n\nThe workflow is controlled externally via a Google Sheet (`Campaign Start`). The process is fully automated once initiated.\n\n1.  **Job Activation:** The process begins when a row in the sheet has its `Action` set to `Submit` and its `Status` is `To_Do`.\n2.  **Job Selection:** The workflow fetches the single oldest pending job to ensure sequential, first-in-first-out processing.\n3.  **Configuration Loading:** It then loads global settings (API limits, output folders, notification emails) from the `KW_Reseach_Setting` sheet for the run.\n\n### 3. How to Use This Workflow\n\n#### **3.1: Credentials & Settings**\n\nBefore running, ensure all required credentials and settings are correctly configured.\n\n*   **Connect API Keys:** Enter your credentials in the respective nodes for `DataForSEO Basic Auth`, `Google Sheets`, `Google Drive`, `Gmail`, and `S3`.\n*   **Configure Settings Sheet:** Open the `KW_Reseach_Setting` Google Sheet and verify that all parameters (e.g., `Email to receive report`, `Google Drive Folder id`, API `Litmit`) are set correctly.\n\n#### **3.2: Execution**\n\nThis system is designed primarily as a sub-workflow but can also be run via its trigger.\n\n*   **As a Sub-Workflow (Recommended):** When called by a parent workflow, it will execute its full logic.\n    *   **On Success:** It returns a single, structured JSON object containing the complete normalized data payload (from the `Normalize_and_Compact` node), including the generated `html_report`.\n    *   **On Failure:** It executes the error branch (updates sheet, sends email) and returns **no data** to the parent workflow. The parent workflow should check if the output from this sub-workflow is empty to detect a failure.\n*   **Via Google Sheets Trigger:** To run in standalone \"listener\" mode, activate the `SEVOsmith_Trigger`. It will automatically poll the control sheet for new jobs to process.\n\n**ðŸ‘‰ Tip:** To test a single component, you can manually execute any of the HTTP Request nodes to see the live API response structure.\n\n### 4. The Process Flow: A Six-Stage Pipeline\n\nThe workflow operates in distinct zones, providing a clear and maintainable structure.\n\n*   **â‘  Initiation & Configuration:** Identifies the target keyword and loads run-time parameters.\n*   **â‘¡ Caching & Routing:** Checks for a cached result. A **cache hit** bypasses Zone 3 entirely; a **cache miss** proceeds to fetch live data.\n*   **â‘¢ Live Data Fetching & Validation:** Executes nine parallel DataForSEO API calls. Each call is immediately validated; failures are routed to the **Error Handling Branch (â‘¥)**.\n*   **â‘£ Synthesis & Report Generation:** The `Normalize_and_Compact` and `Keyword Research Report Synthesizer` nodes process the raw data into a clean JSON object and generate the final `html_report`.\n*   **â‘¤ Output, Delivery & State Update:** Performs all final actions: uploads the report, caches the new result, and updates the job's `Status` to `Completed`.\n*   **â‘¥ Error Handling Branch:** A terminal path for any failures. It collects all errors, updates the job's `Status` to `Error` in the sheet, and sends a detailed diagnostic email.",
        "height": 1280,
        "width": 1520,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        7280,
        928
      ],
      "id": "381f1a55-a22a-496f-a015-0e0f2d261106",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8",
          "mode": "list",
          "cachedResultName": "SEVOsmith_Manager_Sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 484582664,
          "mode": "list",
          "cachedResultName": "Campaign Start",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1S4lMHD8A4BlhPVboAC5mnlb9TjN2DoZF5lnz_L1AcX8/edit#gid=484582664"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Status": "Processing",
            "Session ID": "={{ $('Generate_Session_ID').item.json.session_id }}",
            "Keyword": "={{ $('Set Input Data').item.json.keyword }}",
            "Execution ID": "={{ $json.workflow_execution_id }}"
          },
          "matchingColumns": [
            "Keyword"
          ],
          "schema": [
            {
              "id": "Project",
              "displayName": "Project",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Session ID",
              "displayName": "Session ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Execution ID",
              "displayName": "Execution ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Keyword",
              "displayName": "Keyword",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Action",
              "displayName": "Action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Report in G-drive",
              "displayName": "Report in G-drive",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Report in Cloudflade R2",
              "displayName": "Report in Cloudflade R2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Raw Data",
              "displayName": "Raw Data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Notes",
              "displayName": "Notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        2304,
        1328
      ],
      "id": "a01bef96-0319-4e1a-9ab0-cd22d79c6b7f",
      "name": "Update Status \"Processing\"",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "auYpM9otybGTlYsx",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        3296,
        1344
      ],
      "id": "9555885c-27d0-4b07-a0d4-67f01f36f0a3",
      "name": "Sending HTTP Request"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "712f3f4e-6349-4fd2-b104-2f7e0426122b",
              "name": "keyword_research_orchestrator",
              "value": "={{ $('Restore State').item.json.final_payload }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        10688,
        624
      ],
      "id": "bb16b7f3-14c0-480a-9552-e5f9fd0dad0c",
      "name": "Workflow Output"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        4752,
        -656
      ],
      "id": "2cbef4c4-8f6f-43c4-b9ce-376f3a982626",
      "name": "Transfer Input Data"
    },
    {
      "parameters": {
        "operation": "copy",
        "fileId": {
          "__rl": true,
          "value": "=1IoiTGW3_4IMnpnxCJY-pO4doKrvNUI_5pPDjNTgOhCc",
          "mode": "id"
        },
        "name": "={{ $('Set Input Data').item.json.cache_key }}",
        "sameFolder": "={{ true }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "mode": "list",
          "value": "root",
          "cachedResultName": "/ (Root folder)"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        6960,
        464
      ],
      "id": "07612dc0-b471-4d07-800f-ae79a18263e8",
      "name": "Google Drive Copy KW Template",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "sldlKM4CMS0lIS4K",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "keyword_records",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        6960,
        688
      ],
      "id": "4e15167f-2a5b-42a2-8da8-16156cb26361",
      "name": "Split Out KW and Metrics"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4cdd730b-1f7b-4959-8038-7b96cd92723e",
              "leftValue": "={{ $('Set Input Data').item.json.save_raw_data }}",
              "rightValue": "Yes",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        6752,
        480
      ],
      "id": "11d66077-eb10-474f-a11d-e4407909c344",
      "name": "Save Raw Data?"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7d4153d0-c5ba-41fd-bc17-cd19554ce535",
              "name": "keyword_records",
              "value": "={{ $('Normalize_and_Compact').item.json.keyword_records }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        7216,
        464
      ],
      "id": "2cf7d1c6-fef5-4cce-b035-5bcf5f8fe2e7",
      "name": "Get KW Records"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        10432,
        -400
      ],
      "id": "5d339724-69a2-440f-b70b-a9462887b2c1",
      "name": "Drive Path Complete"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        10432,
        -48
      ],
      "id": "5a5649f7-af67-4517-9513-bbce14cb14dc",
      "name": "S3 Path Complete"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        10672,
        -224
      ],
      "id": "91917f3e-e9df-45b8-8f91-d1c78a3bdd1b",
      "name": "Wait for All Upload Paths"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        10688,
        176
      ],
      "id": "dca69ffe-e84d-40ca-b637-e0627b098e65",
      "name": "Restore State"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        7776,
        592
      ],
      "id": "d9859542-fd62-4215-86ea-621ae6871175",
      "name": "Raw Data Path Complete"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        7568,
        496
      ],
      "id": "d70d484f-519f-4754-b7a7-52d6212ec983",
      "name": "No Need to save Raw"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c77c2b80-0821-4342-8c2c-345812ec6244",
              "name": "user_input_data",
              "value": "={{ $('Final KW Payload').item.json.final_kw_data_payload[0] }}",
              "type": "object"
            },
            {
              "id": "f0967d97-b2ef-4b41-8a50-bd76be4aed0f",
              "name": "final_payload",
              "value": "={{ $('Final KW Payload').item.json.final_kw_data_payload[2] }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        10016,
        192
      ],
      "id": "dc933c54-39ba-4403-beec-a70b8380fce6",
      "name": "Isolate Final Payload"
    },
    {
      "parameters": {
        "content": "## Normalize Raw Data",
        "height": 320,
        "width": 816
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5856,
        80
      ],
      "id": "329aaed2-3267-44c5-ac50-edc56aaa3700",
      "name": "Sticky Note11"
    },
    {
      "parameters": {
        "content": "## Save Raw Data to Google Sheets\n",
        "height": 480,
        "width": 2112,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        6688,
        384
      ],
      "id": "bf78fca8-45a3-41fb-964d-20bdc361c82b",
      "name": "Sticky Note14"
    },
    {
      "parameters": {
        "content": "## Save Data to Cache\n",
        "height": 384,
        "width": 2112,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        6688,
        -16
      ],
      "id": "7f50e992-e6d2-4787-be20-750be6e94695",
      "name": "Sticky Note15"
    },
    {
      "parameters": {
        "content": "## Keyword Report Synthesizer",
        "height": 656,
        "width": 2112,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        6688,
        -672
      ],
      "id": "80929fb5-fcd0-4441-a0dd-20225513505c",
      "name": "Sticky Note16"
    },
    {
      "parameters": {
        "content": "## 5.1 Upload Report on Google Drive and Cloudflade R2",
        "height": 752,
        "width": 2032,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        8832,
        -672
      ],
      "id": "ae9763fc-6039-4331-baea-ee50f8de2bcb",
      "name": "Sticky Note19"
    },
    {
      "parameters": {
        "content": "## 5.2Update the Completed Status And Return data to parent workflow",
        "height": 768,
        "width": 2032,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        8832,
        96
      ],
      "id": "ac403f47-a6e9-4898-acba-4708ec11cf7d",
      "name": "Sticky Note23"
    },
    {
      "parameters": {
        "content": "# SEVOsmith Keyword Orchestrator v1.1",
        "height": 96,
        "width": 1172,
        "color": 3
      },
      "id": "e04a33b5-cc5c-4186-9f65-243f67411838",
      "name": "Sticky Note26",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1040,
        576
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "# **1. Create Data Table names: SEVOsmith_KW_Cache table**\n\n* `Project` (string)\n* `session_id` (string)\n* `cache_id` (string)\n* `cache_content` (string)\n\n# **2.  Create G-Drive Structure:**\nCreate folder inside your google drive:\n    *   `SEVOsmith` (Main Folder)\n        *   `KW_research_report` (Sub-folder)\n        *   `KW_research_raw_data` (Sub-folder)\n3.  **Copy Template Files:**\n    *   **Manager Sheet:** [Copy this template](https://docs.google.com/spreadsheets/d/1ssyXqC1JCJhjvrzwByoVf1QWLNZQ4P3K6HcJuhNOymM/edit?gid=484582664#gid=484582664), name it `SEVOsmith_Manager_Sheet`, and move it into your `SEVOsmith` folder.\n    *   **Raw Data Template:** [Copy this template](https://docs.google.com/spreadsheets/d/1CZsJ5Mh2cwh6i0WlDb3HaBk96_bBm71HLkBAZneYvYY/edit?gid=2108933567#gid=2108933567), name it `KW_Research_Template_Source`, and move it into your `KW_research_raw_data` folder.\n\n# **3. Create n8n Credentials**\n1.  **Create n8n Credentials:** In n8n, create the necessary credentials: `HTTP Basic Auth` (for DataForSEO), `Google OAuth2`, `Gmail OAuth2`, and `AWS` (for S3/R2).\n2.  **Populate Settings Sheet:** Open your `SEVOsmith_Manager_Sheet`, go to the `KW_Reseach_Setting` tab, and populate the values.\n\n| Setting Name | Your Value |\n| :--- | :--- |\n| Location Code | `2840` |\n| Language Code | `en` |\n| Litmit | `50` |\n| Upload to G-drive | `Yes` |\n| Upload to Cloudflade R2 | `Yes` |\n| Save Raw Data | `Yes` |\n| Email Notify | `Yes` |\n| Email to receive report | `your.email@example.com` |\n| **Google Drive Folder id** | *<ID of your `KW_research_report` folder>* |\n| **Cloudflade R2 link** | *<Your public R2/S3 bucket URL>* |\n\n# **4. Connect, Save, and Activate**\n1.  **Assign Credentials** to all relevant nodes in the workflow.\n2.  **Connect Google Sheet IDs:**\n    *   Paste the ID of your `SEVOsmith_Manager_Sheet` into the `Document ID` field of all Google Sheets nodes.\n    *   Paste the ID of your `KW_Research_Template_Source` into the `File ID` field of the `Google Drive Copy KW Template` node.\n3.  **Connect Data Table:** Select your `SEVOsmith_KW_Cache` table in the `Get Cache` and `Create Cache` nodes.\n4.  **Save and Activate** the workflow.\n",
        "height": 1200,
        "width": 1056,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        8800,
        1008
      ],
      "id": "fd54c68c-55e2-4a13-bd48-858f59b736ab",
      "name": "Sticky Note28"
    },
    {
      "parameters": {
        "content": "# Setup Guide",
        "height": 80,
        "width": 1060,
        "color": 2
      },
      "id": "20f3d130-1c7b-4f36-8200-6219271f52a9",
      "name": "Sticky Note27",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        8800,
        928
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        9360,
        176
      ],
      "id": "c34366ae-f54a-4e0b-8456-1b30ae9ddbdf",
      "name": "Wait for All Processes"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        6528,
        192
      ],
      "id": "470d9f85-6cd2-46fb-8945-765998317beb",
      "name": "Normalized Data Hub"
    }
  ],
  "pinData": {
    "SEVOsmith_Trigger": [
      {
        "json": {
          "Project": "Nextgrowth",
          "Session ID": "25110903159ba9",
          "Execution ID": "",
          "Date": "",
          "Keyword": "n8n",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/12a8gL7Qn3z5LDyrF1GKDu33WNNi8jNLs/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/n8n__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/1QdpfCH7LZt8a7u3AjbCoUmGHpTjejpP0pvGQFNIK_XE/view?usp=sharing",
          "Notes": ""
        }
      },
      {
        "json": {
          "Project": "Nextgrowth",
          "Session ID": "2511090338acb5",
          "Execution ID": "",
          "Date": "",
          "Keyword": "n8n monitoring",
          "Action": "Submit",
          "Status": "Error",
          "Report in G-drive": "",
          "Report in Cloudflade R2": "",
          "Raw Data": "https://docs.google.com/spreadsheets/d/1A3cbZOtWiH1pxpLJ07Ll_bDOdcxxb1AWkvF27Kx4p0Q/view?usp=sharing",
          "Notes": "[serp]: Invalid Field: 'language_code'."
        }
      },
      {
        "json": {
          "Project": "Nextgrowth",
          "Session ID": "2511090521d73b",
          "Execution ID": "",
          "Date": "",
          "Keyword": "n8n self hosted",
          "Action": "Submit",
          "Status": "Error",
          "Report in G-drive": "",
          "Report in Cloudflade R2": "",
          "Raw Data": "https://docs.google.com/spreadsheets/d/1ejfJSFkj3scHDskcv9S3Zd-yGYzekrNgLU51op3q2wo/view?usp=sharing",
          "Notes": "[serp]: Invalid Field: 'language_code'."
        }
      },
      {
        "json": {
          "Project": "Nextgrowth",
          "Session ID": "2511100010a2c9",
          "Execution ID": "",
          "Date": "",
          "Keyword": "n8n keyword research",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/1paNGJrxT0dNeHw_9E3m5H1M1MrfJG32U/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/n8n-keyword-research__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/1ABAxO8BZIBKC67I8vWiwe9jIrzU4V0TCvShkSISJpS0/view?usp=sharing",
          "Notes": "Successful"
        }
      },
      {
        "json": {
          "Project": "Nextgrowth",
          "Session ID": "2511090611cdfb",
          "Execution ID": "",
          "Date": "",
          "Keyword": "ai seo content generator",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/14fA6dO904rKAO3ZEBCEtm6e35zEGvBG8/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/ai-seo-content-generator__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/1MTzkn0KrkzKZd-sFbaMiOJMsdBzOQHbjrKTFRKfpOHc/view?usp=sharing",
          "Notes": "Successful"
        }
      },
      {
        "json": {
          "Project": "New Project",
          "Session ID": "2511090553f4a7",
          "Execution ID": "",
          "Date": "",
          "Keyword": "mÃ¡y nÃ©n khÃ­ trá»¥c vÃ­t",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/1rItC5k6LuZclmL6vzIXxkY-Zq4KvlCuJ/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/mÃ¡y-nÃ©n-khÃ­-trá»¥c-vÃ­t__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/1XICybBTuPEptvOZItoOlUgO2nvvFud3AIgTXr9viKTg/view?usp=sharing",
          "Notes": "Successful"
        }
      },
      {
        "json": {
          "Project": "Devoted",
          "Session ID": "2511090950689a",
          "Execution ID": "",
          "Date": "",
          "Keyword": "Golden Retriever",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/1PS0bjk__EI83rIBHhjmTAtIz9Dx1tZsl/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/golden-retriever__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/1TZhLkRGcX2qbQpbBDN5GofZCad-FwnqTA7KAGQpGHGg/view?usp=sharing",
          "Notes": "Successful"
        }
      },
      {
        "json": {
          "Project": "Devoted",
          "Session ID": "2511091018e05d",
          "Execution ID": "",
          "Date": "",
          "Keyword": "1 year old Golden Retriever",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/1gm6yEksXe_LScphijJFDMCijyMh0dbFe/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/1-year-old-golden-retriever__keyword_research.html",
          "Raw Data": "",
          "Notes": "Successful"
        }
      },
      {
        "json": {
          "Project": "Devoted",
          "Session ID": "2511091018a8a3",
          "Execution ID": "",
          "Date": "",
          "Keyword": "2 year old Golden Retriever",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/12qnfbhcARyRoeeaQPmyO94s-TEKWPAY0/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/2-year-old-golden-retriever__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/19Jw-6S5i2Sk-tlEkIP04BzSDQxKI9qDbsAH1UOjQDv8/view?usp=sharing",
          "Notes": "Successful"
        }
      },
      {
        "json": {
          "Project": "Devoted",
          "Session ID": "25110915109abb",
          "Execution ID": "",
          "Date": "",
          "Keyword": "8 week old golden retriever",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/12geFexBm_W2DhuQhgegSjuxATTW2JdgZ/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/8-week-old-golden-retriever__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/1lcyR0_hkEYK0SKcB2N60yu1WWHO6S-VgXZx-2Qlw41k/view?usp=sharing",
          "Notes": ""
        }
      },
      {
        "json": {
          "Project": "Nextgrowth",
          "Session ID": "2511091515ed6a",
          "Execution ID": "",
          "Date": "",
          "Keyword": "n8n keyword research",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/1z5zGBPJfJ1R-a1qoXKpyALIegq1Y1CWK/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/n8n-keyword-research__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/1JNQ8Y3WiNBOrQKDlWfeswhTTmbvyHr_wxdRPkWp7pmg/view?usp=sharing",
          "Notes": ""
        }
      },
      {
        "json": {
          "Project": "Devoted",
          "Session ID": "2511100256c6e0",
          "Execution ID": "",
          "Date": "",
          "Keyword": "12 week old golden retriever",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/1p81ERYPm1Yy4aJf3nGv51WIeCk5nwc5a/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/12-week-old-golden-retriever__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/10q-iBEoF9QtlFne-5Rk9LSxpanMGTzdfjJlnohwcpZU/view?usp=sharing",
          "Notes": "Successful"
        }
      },
      {
        "json": {
          "Project": "Devoted",
          "Session ID": "25111003157be3",
          "Execution ID": "",
          "Date": "",
          "Keyword": "6 month old golden retriever",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/1ph4PGaYi7mCxXx7e6ZEuLQoC-x5y_WDM/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/6-month-old-golden-retriever__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/1DIahGe7ycHrgWmdgCkk8535FpsT_g1JlptTWU-f1LVQ/view?usp=sharing",
          "Notes": "Successful"
        }
      },
      {
        "json": {
          "Project": "Devoted",
          "Session ID": "2511100913df3a",
          "Execution ID": "",
          "Date": "",
          "Keyword": "6 week old golden retriever",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/1MQJp3_FGJ5emMcwhHtRt9IVJBtUyfiHq/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/6-week-old-golden-retriever__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/1hp0QKDEq8FyJ5Wa5lxtJpPQ59IS9DLnAyAd4bGpEtDs/view?usp=sharing",
          "Notes": "Successful"
        }
      },
      {
        "json": {
          "Project": "Devoted",
          "Session ID": 25111011533162,
          "Execution ID": "",
          "Date": "",
          "Keyword": "puppy potty crate training",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/1GA4Gu2nynXFvkRiz0T1MfZp8Y1S6pCCB/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/puppy-potty-crate-training__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/1M5g2SDG3pjxSsHb9KZnFVmJEzpc76Y4dPvSMJkz0PQs/view?usp=sharing",
          "Notes": "Successful"
        }
      },
      {
        "json": {
          "Project": "Devoted",
          "Session ID": "",
          "Execution ID": "",
          "Date": "",
          "Keyword": "puppy chew toys",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/1U-kOlvKu6brCfsZG0OhtvDM0sBXgd8R4/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/puppy-chew-toys__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/1RsfTWBkTSzxenryCaHVVTjFwk6X8j73Tq5Y9TFzCH7Y/view?usp=sharing",
          "Notes": "Successful"
        }
      },
      {
        "json": {
          "Project": "New Project",
          "Session ID": 25111100272038,
          "Execution ID": 3488,
          "Date": "",
          "Keyword": "best seo tools for agencies",
          "Action": "Submit",
          "Status": "Completed",
          "Report in G-drive": "https://drive.google.com/file/d/1IsDOujOnHaZ52Myh7zxKaHab_A_jZisa/view?usp=sharing",
          "Report in Cloudflade R2": "https://pub-888f481be9bf4ba69f23d2e208e4a20b.r2.dev/article/best-seo-tools-for-agencies__keyword_research.html",
          "Raw Data": "https://docs.google.com/spreadsheets/d/14lJAQb_56N5yzV0GtwWd_gi7JbYNdO2SZW8i2Qhq5bQ/view?usp=sharing",
          "Notes": "Successful"
        }
      },
      {
        "json": {
          "Project": "Nextgrowth",
          "Session ID": "",
          "Execution ID": "",
          "Date": "",
          "Keyword": "n8n self hosted",
          "Action": "Submit",
          "Status": "To_Do",
          "Report in G-drive": "",
          "Report in Cloudflade R2": "",
          "Raw Data": "",
          "Notes": ""
        }
      }
    ]
  },
  "connections": {
    "Search Intent": {
      "main": [
        [
          {
            "node": "If7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Keyword Overview": {
      "main": [
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Keyword Ideas": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SERP Google": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Keyword Data": {
      "main": [
        [
          {
            "node": "If8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SERP Youtube": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Related Keywords": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Mode": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "serp_youtube": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "serp_google": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ai_mode_data": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "related_keywords": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "keyword_ideas": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 4
          }
        ]
      ]
    },
    "keyword_overview": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 5
          }
        ]
      ]
    },
    "search_intent": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 6
          }
        ]
      ]
    },
    "ai_keyword_data": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 7
          }
        ]
      ]
    },
    "HTTP Subtopics": {
      "main": [
        [
          {
            "node": "If9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "keyword_subtopics": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 8
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "raw_keyword_research_data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "raw_keyword_research_data": {
      "main": [
        [
          {
            "node": "Prepare for Normalization",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalize_and_Compact": {
      "main": [
        [
          {
            "node": "Normalized Data Hub",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cache Hit?": {
      "main": [
        [
          {
            "node": "Get data from Cache",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Sending HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get KW Research Setting": {
      "main": [
        [
          {
            "node": "Generate_Session_ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Main Keyword": {
      "main": [
        [
          {
            "node": "Get KW Research Setting",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Input Data": {
      "main": [
        [
          {
            "node": "Transfer Input Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update Status \"Processing\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEVOsmith_Trigger": {
      "main": [
        [
          {
            "node": "Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate_Session_ID": {
      "main": [
        [
          {
            "node": "Set Input Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Cache": {
      "main": [
        [
          {
            "node": "Wait for All Processes",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Convert Json to String",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Sheet Row": {
      "main": [
        [
          {
            "node": "Add Keyword Metrics to Google Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Keyword Metrics to Google Sheet": {
      "main": [
        [
          {
            "node": "Update Link Raw Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get data from Cache": {
      "main": [
        [
          {
            "node": "Merge Data Sources",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert Json to String": {
      "main": [
        [
          {
            "node": "Create Cache",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Keyword Research Report Synthesizer": {
      "main": [
        [
          {
            "node": "Consolidate Final Data",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Prepare Email": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload HTML Report S3": {
      "main": [
        [
          {
            "node": "Get Link S3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload Keyword Research Report G-drive": {
      "main": [
        [
          {
            "node": "Get Link G-Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Prepare Email",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Workflow Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Final KW Payload": {
      "main": [
        [
          {
            "node": "Upload_Drive?",
            "type": "main",
            "index": 0
          },
          {
            "node": "Upload_S3",
            "type": "main",
            "index": 0
          },
          {
            "node": "Wait for All Processes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload_Drive?": {
      "main": [
        [
          {
            "node": "Upload Keyword Research Report G-drive",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Drive Path Complete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload_S3": {
      "main": [
        [
          {
            "node": "Upload HTML Report S3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "S3 Path Complete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message": {
      "main": [
        [
          {
            "node": "Workflow Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Link G-Drive": {
      "main": [
        [
          {
            "node": "Update Report Link G-drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Link S3": {
      "main": [
        [
          {
            "node": "Update Report Link S3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Report Link G-drive": {
      "main": [
        [
          {
            "node": "Drive Path Complete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Report Link S3": {
      "main": [
        [
          {
            "node": "S3 Path Complete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Consolidate Final Data": {
      "main": [
        [
          {
            "node": "Final KW Payload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Cache": {
      "main": [
        [
          {
            "node": "Cache Hit?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Link Raw Data": {
      "main": [
        [
          {
            "node": "Raw Data Path Complete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare for Normalization": {
      "main": [
        [
          {
            "node": "Normalize_and_Compact",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter": {
      "main": [
        [
          {
            "node": "Get Main Keyword",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Data Sources": {
      "main": [
        [
          {
            "node": "Keyword Research Report Synthesizer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "serp_google",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Failed Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Status \"Error\"": {
      "main": [
        [
          {
            "node": "Notify On Error?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Email for Error Notification": {
      "main": [
        [
          {
            "node": "Stop and Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Failed Response": {
      "main": [
        [
          {
            "node": "Update Status \"Error\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notify On Error?": {
      "main": [
        [
          {
            "node": "Send Email for Error Notification",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stop and Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "serp_youtube",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Failed Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "ai_mode_data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Failed Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "related_keywords",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Failed Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "keyword_ideas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Failed Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "keyword_overview",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Failed Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If7": {
      "main": [
        [
          {
            "node": "search_intent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Failed Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If8": {
      "main": [
        [
          {
            "node": "ai_keyword_data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Failed Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If9": {
      "main": [
        [
          {
            "node": "keyword_subtopics",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Failed Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Status \"Processing\"": {
      "main": [
        [
          {
            "node": "Get Cache",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sending HTTP Request": {
      "main": [
        [
          {
            "node": "SERP Youtube",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Mode",
            "type": "main",
            "index": 0
          },
          {
            "node": "Related Keywords",
            "type": "main",
            "index": 0
          },
          {
            "node": "Keyword Ideas",
            "type": "main",
            "index": 0
          },
          {
            "node": "Keyword Overview",
            "type": "main",
            "index": 0
          },
          {
            "node": "Search Intent",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Keyword Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "HTTP Subtopics",
            "type": "main",
            "index": 0
          },
          {
            "node": "SERP Google",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Status \"Completed\"": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transfer Input Data": {
      "main": [
        [
          {
            "node": "Consolidate Final Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out KW and Metrics": {
      "main": [
        [
          {
            "node": "Prepare Sheet Row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Raw Data?": {
      "main": [
        [
          {
            "node": "Google Drive Copy KW Template",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Need to save Raw",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive Copy KW Template": {
      "main": [
        [
          {
            "node": "Get KW Records",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get KW Records": {
      "main": [
        [
          {
            "node": "Split Out KW and Metrics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Workflow Output": {
      "main": [
        []
      ]
    },
    "Wait for All Upload Paths": {
      "main": [
        [
          {
            "node": "Restore State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Drive Path Complete": {
      "main": [
        [
          {
            "node": "Wait for All Upload Paths",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "S3 Path Complete": {
      "main": [
        [
          {
            "node": "Wait for All Upload Paths",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Restore State": {
      "main": [
        [
          {
            "node": "Update Status \"Completed\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Raw Data Path Complete": {
      "main": [
        [
          {
            "node": "Wait for All Processes",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "No Need to save Raw": {
      "main": [
        [
          {
            "node": "Raw Data Path Complete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Isolate Final Payload": {
      "main": [
        [
          {
            "node": "Restore State",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Wait for All Processes": {
      "main": [
        [
          {
            "node": "Isolate Final Payload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalized Data Hub": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save Raw Data?",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge Data Sources",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "oxfDvlgwQE8SXHM4",
    "saveExecutionProgress": true
  },
  "versionId": "7a60dea2-9207-46a6-b84a-eeda71ca28b1",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "11e9efcdcf8b81c33a6dc0fbb8a65585e44890419633abdd99da8b32fbffb48e"
  },
  "id": "oxfDvlgwQE8SXHM4",
  "tags": []
}
